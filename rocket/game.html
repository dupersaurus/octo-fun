<!-- Standalone Generated By Octo (octo-ide.com) -->
<script>data={"program":"# Background: #000d14\n# FG1: #00aeff\n# FG2: #fff\n# Blend: #fff\n# Silence: #000d14\n\n:alias x v1\n:alias y v2\n\n: main\n    i := long will-draw-logo\n    load ve - ve\n\n    if ve == 0 then builder-loop\n    game-loop\n;\n\n:macro stage-data-index-shift index {\n    index <<= index\n    index <<= index\n    index <<= index\n}\n\n############################################################\n# Builder\n############################################################\n# temp\n\n# permanent\n:alias selected-bot-stage    v3\n:alias selected-mid-stage    v4\n:alias selected-top-stage    v5\n:alias current-stage         v6\n\n:alias count-bot-stage       v7\n:alias unlock-bot-stage      v8\n:alias count-mid-stage       v9\n:alias unlock-mid-stage      va\n:alias count-top-stage       vb\n:alias unlock-top-stage      vc\n\n:alias stage-offset          vd\n:alias stage-height          ve\n\n:const BOTTOM_STAGE 0\n:const MIDDLE_STAGE 2\n:const TOP_STAGE 4\n:const STAGE_TOO_FAR 6\n:const SHIP_Y 18\n:const UI_Y 36\n:const BOTTOM_STAGE_X 24\n:const MIDDLE_STAGE_X 64\n:const TOP_STAGE_X 104\n\n: builder-loop\n    hires\n\n    current-stage := BOTTOM_STAGE\n    selected-bot-stage := 0\n    selected-mid-stage := 0\n    selected-top-stage := 0\n    \n    i := long builder-data\n    load count-bot-stage - unlock-top-stage\n\n    apply-bottom-stage\n    apply-middle-stage\n    apply-top-stage\n    draw-stage-arrow\n\n    loop\n        v1 := key\n        if v1 == 6 then jump launch-rocket\n        read-input\n    again\n;\n\n: launch-rocket\n    i := long rocket-data\n    save selected-bot-stage - selected-top-stage\n;\n\n: read-input\n    v0 := current-stage\n    if v1 == OCTO_KEY_A then jump0 select-previous\n    if v1 == OCTO_KEY_D then jump0 select-next\n    if v1 == OCTO_KEY_W then jump stage-up\n    if v1 == OCTO_KEY_S then jump stage-down\n;\n\n: stage-up\n    draw-stage-arrow\n    current-stage += 2\n    if current-stage == STAGE_TOO_FAR then current-stage := BOTTOM_STAGE\n    draw-stage-arrow\n;\n\n: stage-down\n    draw-stage-arrow\n    current-stage += -2\n    if current-stage == -2 then current-stage := TOP_STAGE\n    draw-stage-arrow\n;\n\n: draw-stage-arrow\n    if current-stage == BOTTOM_STAGE    then x := BOTTOM_STAGE_X\n    if current-stage == MIDDLE_STAGE    then x := MIDDLE_STAGE_X\n    if current-stage == TOP_STAGE       then x := TOP_STAGE_X\n\n    y := 4\n    i := long builder-ui-arrow\n    plane 1\n    sprite x y 7\n;\n\n:macro select-previous-item draw selected-item min max {\n    if max == 0 then return\n    \n    draw\n\n    selected-item += -1\n    if selected-item == min begin\n        selected-item := max\n        selected-item += -1\n    end\n\n    draw\n}\n\n:macro select-next-item draw selected-item min max {\n    if max == 0 then return\n\n    draw\n\n    selected-item += 1\n    if selected-item == max then selected-item := min\n\n    draw\n}\n\n: select-previous\n    jump select-previous-bottom\n    jump select-previous-middle\n    jump select-previous-top\n;\n\n: select-next\n    jump select-next-bottom\n    jump select-next-middle\n    jump select-next-top\n;\n\n: select-previous-bottom\n    select-previous-item apply-bottom-stage selected-bot-stage -1 unlock-bot-stage\n;\n\n: select-next-bottom\n    select-next-item apply-bottom-stage selected-bot-stage 0 unlock-bot-stage\n;\n\n: select-previous-middle\n    select-previous-item apply-middle-stage selected-mid-stage -1 unlock-mid-stage\n;\n\n: select-next-middle\n    select-next-item apply-middle-stage selected-mid-stage 0 unlock-mid-stage\n;\n\n: select-previous-top\n    select-previous-item apply-top-stage selected-top-stage -1 unlock-top-stage\n;\n\n: select-next-top\n    select-next-item apply-top-stage selected-top-stage 0 unlock-top-stage\n;\n\n:macro apply-stage selected-item data jump-table {\n    v0 := selected-item\n    stage-data-index-shift v0\n\n    i := long data\n    i += v0\n    load stage-offset - stage-height\n\n    v0 := stage-offset\n    jump0 jump-table\n}\n\n: apply-bottom-stage\n    apply-stage selected-bot-stage bottom-stage-data stage-bottom-jump\n;\n\n: apply-middle-stage\n    apply-stage selected-mid-stage middle-stage-data stage-middle-jump\n;\n\n: apply-top-stage\n    apply-stage selected-top-stage top-stage-data stage-top-jump\n;\n\n:macro draw-stage X Y selection max {\n    x := X\n    y := Y\n    plane 1\n    sprite x y 0\n\n    draw-selection-dots x y selection max\n}\n\n:macro draw-selection-dots X Y selection max {\n    X += 12\n    Y := UI_Y\n    v0 := 0\n    loop\n        while v0 != max\n\n        i := long builder-ui-dot\n        sprite X Y 1\n        \n        if v0 == selection begin\n            plane 2\n            sprite X Y 1\n            plane 1\n        end\n\n        Y += 2\n        v0 += 1\n    again\n}\n\n: draw-bottom-stage\n    draw-stage BOTTOM_STAGE_X SHIP_Y selected-bot-stage unlock-bot-stage\n;\n\n: draw-middle-stage\n    draw-stage MIDDLE_STAGE_X SHIP_Y selected-mid-stage unlock-mid-stage\n;\n\n: draw-top-stage\n    draw-stage TOP_STAGE_X SHIP_Y selected-top-stage unlock-top-stage\n;\n\n############################################################\n# Game\n############################################################\n### temps\n# v3, v4, v5 used at start of some steps to cache calculations\n\n# pre-launch\n:alias launch-step v7\n\n# flying mode\n#:alias steering-counter v5\n#:alias drift-offset     v6\n#:alias drift-direction  v7\n#:alias drift-counter    v8\n#:alias drift-step       v9\n\n:alias draw-rocket-temp     v3 # protected in loops using draw-rocket\n:alias scroll-direction     v9 # used within scrolling loops\n:alias altitude-step        v5 # safe in play loop\n\n# transfer\n:alias transfer-target      v4\n:alias transfer-result      v5\n\n### permanent\n\n# cache rocket sprite offsets\n# only allows 10 stages when offset is saved as offset\n# TODO 1: save offset as index and expand\n# TODO 2: load offset as needed\n:alias game-bottom-stage-data-offset   va\n:alias game-middle-stage-data-offset   vb\n:alias game-top-stage-data-offset      vc\n\n:alias total-altitude   vd\n:alias altitude         ve\n\n:const ROCKET_X             38\n:const ROCKET_Y             30\n:const SMOKE_LEFT           16\n:const SMOKE_RIGHT          32\n:const LAUNCH_STEP_COUNT    19\n:const LAUNCH_STEP_LAUNCH   2\n:const MIN_DRIFT            15\n:const MAX_DRIFT            49\n\n:const LAUNCH_FAILED    2\n\n:const O0 200 # no orbit low\n:const O1 201 # no orbit med\n:const O2 202 # no orbit high\n:const OO 1   # orbit\n:const M0 2   # moon crash\n:const M1 3   # moon land\n:const A0 4   # mars crash\n:const A1 5   # mars land\n:const S0 6   # saturn crash\n:const S1 7   # saturn land\n:const XP 100 # pad failure\n:const XF 101 # launch failure fire\n:const XL 102 # launch failure low\n:const XM 103 # launch failure med\n:const XH 104 # launch failure high\n\n:const ALTITUDE_TARGET_0       64\n:const ALTITUDE_TARGET_1_SHORT 96\n:const ALTITUDE_TARGET_1       128\n:const ALTITUDE_TARGET_2_SHORT 160\n:const ALTITUDE_TARGET_2       192\n:const ALTITUDE_TARGET_3_SHORT 230\n:const ALTITUDE_TARGET_3       245\n\n:const TRANSFER_MISS    0\n:const TRANSFER_IMPACT  1   \n:const TRANSFER_GOOD    2   \n\n:const PROGRESSION_0    0\n:const PROGRESSION_1    6\n:const PROGRESSION_2    12\n:const PROGRESSION_3    18\n:const PROGRESSION_4    24\n:const PROGRESSION_5    30\n:const PROGRESSION_6    36\n\n:macro get-stage-data-offset in out temp {\n    temp := 0b00011111\n    out := in\n    out &= temp\n}\n\n:macro set-stage-data-offset value to temp {\n    temp := 0b11100000\n    to &= temp\n    to += value\n}\n\n:macro get-stage-x-offset in out {\n    out := in\n    out >>= out\n    out >>= out\n    out >>= out\n    out >>= out\n    out >>= out\n    #out += 1\n    #out >>= out\n}\n\n:macro set-stage-x-offset value to temp {\n    value <<= value\n    value <<= value\n    value <<= value\n    value <<= value\n    value <<= value\n    #value <<= value\n\n    temp := 0b00111111\n    to &= temp\n    to += value\n}\n\n:macro draw-exhaust x y temp {\n    temp := random 0b11\n\n    plane 2\n    if temp == 0 then i := long exhaust-plume-1\n    if temp == 1 then i := long exhaust-plume-2\n    if temp == 2 then i := long exhaust-plume-3\n    if temp == 3 then i := long exhaust-plume-4\n\n    sprite x y 5\n}\n\n:macro end-mission unlock {\n    i := long total-mission-count\n    load v1 - v1\n    v1 += 1\n    save v1 - v1\n\n    unlock\n}\n\n: game-loop\n    clear\n    hires\n\n    game-bottom-stage-data-offset := 0\n    game-middle-stage-data-offset := 0\n    game-top-stage-data-offset := 0\n\n    ## cache rocket information\n    i := long rocket-data\n    load v2\n    \n    i := long bottom-stage-data\n    stage-data-index-shift v0\n    i += v0\n\n    load v4 - v5\n    v4 += 6         # ther\n    set-stage-data-offset   v4 game-bottom-stage-data-offset ve\n    set-stage-x-offset      v5 game-bottom-stage-data-offset ve\n\n    i := long middle-stage-data\n    stage-data-index-shift v1\n    i += v1\n    load v4 - v5\n    set-stage-data-offset   v4 game-middle-stage-data-offset ve\n    set-stage-x-offset      v5 game-middle-stage-data-offset ve\n\n    i := long top-stage-data\n    stage-data-index-shift v2\n    i += v2\n    load v4 - v4\n    set-stage-data-offset   v4 game-top-stage-data-offset ve\n\n    calculate-total-altitude\n\n    ## Startup #################################\n    draw-game-start-scene\n    \n    x := 2\n    y := ROCKET_Y\n\n    if total-altitude == XP then jump explode-on-pad\n\n    draw-rocket\n\n    ## Wait for launch #########################\n    loop\n        v0 := 0x6\n        if v0 -key then\n    again\n\n    ## Launch ##################################\n\n    if total-altitude == XF begin \n        draw-rocket\n        jump explode-on-pad\n    end\n\n# initial smoke\n    launch-step := 0\n\n    plane 2\n    i := long launch-smoke-left-1\n    x := 1\n    y := SMOKE_LEFT\n    sprite x y 15\n\n    i := long launch-smoke-right-1\n    x := 1\n    y := SMOKE_RIGHT\n    sprite x y 8\n\n    loop\n        step-launch-smoke\n        wait-for-frame\n        if launch-step != LAUNCH_STEP_LAUNCH then\n    again\n\n    ## Lift off ################################\n    v0 := 0\n    altitude-step := 254\n    \n# prep rocket\n    plane 3\n    altitude := 2\n    y := ROCKET_Y\n\n    loop\n        v3 := v0\n        step-launch-smoke\n\n        x := altitude\n        y := ROCKET_Y\n\n        v0 := v3\n        altitude-step += v0\n        if v0 != 255 then v0 += 5\n        if vf == 1 then lift-off-draw-rocket\n\n        wait-for-frame\n\n        if x != 38 then\n    again\n\n###### Fly ##################################################################\n    loop-fly\n\n###### Fall ##################################################################\n    if vf == LAUNCH_FAILED then loop-launch-failed\n\n###### Orbit ##################################################################\n    if vf != LAUNCH_FAILED then loop-in-orbit\n\n    wait-for-return-to-menu\n;\n\n###### Fly ##################################################################\n: loop-fly\n    # pre-set\n    altitude := 0\n    #drift-offset := 0\n    #drift-direction := 1\n    #drift-counter := 0\n    #drift-step := 75\n    #steering-counter := 100\n\n    loop\n        x := ROCKET_X\n        y := ROCKET_Y\n        #y += drift-offset\n        v0 := 0b1\n        v0 &= altitude\n\n        plane 3\n        x += -3\n        y += -1\n        if v0 == 0 then i := long blast-tail-1\n        if v0 == 1 then i := long blast-tail-2\n        sprite x y 15\n\n        x += -3\n        draw-exhaust x y v3\n\n        x += 6\n        y += 1\n        draw-rocket\n        scroll-left\n\n        #accumulate-drift\n        y := ROCKET_Y\n        #y += drift-offset\n\n        draw-rocket\n\n        x += -3\n        y += -1\n        if v0 == 0 then i := long blast-tail-2\n        if v0 == 1 then i := long blast-tail-1\n        sprite x y 15\n\n        scroll-direction := 0\n        fill-next-slice\n        wait-for-frame\n\n        altitude += 1\n        vf := 0\n\n        if altitude == 20 then check-low-failure\n        if altitude == 40 then check-med-failure\n        if altitude == 60 then check-high-failure\n\n        if vf == LAUNCH_FAILED then return\n        if altitude != ALTITUDE_TARGET_0 then\n    again\n;\n\n: check-low-failure\n    if total-altitude == XL then jump draw-air-explosion\n    if total-altitude == O0 then vf := LAUNCH_FAILED\n;\n\n: check-med-failure\n    if total-altitude == XM then jump draw-air-explosion\n    if total-altitude == O1 then vf := LAUNCH_FAILED\n;\n\n: check-high-failure\n    if total-altitude == XH then jump draw-air-explosion\n    if total-altitude == O2 then vf := LAUNCH_FAILED\n;\n\n###### Fall ##################################################################\n: loop-launch-failed\n    # momentum\n\n    altitude-step := 10\n    loop\n        x := ROCKET_X\n        y := ROCKET_Y\n\n        draw-rocket\n        scroll-left\n        draw-rocket\n\n        scroll-direction := 0\n        fill-next-slice\n\n        vf := altitude-step\n        delay := vf\n        \n        loop\n            vf := delay\n            if vf != 0 then\n        again\n\n        altitude-step += 2\n        altitude += 1\n        if altitude-step != 40 then\n    again\n\n    #altitude += 20\n\n    # fall\n    loop\n        x := ROCKET_X\n        y := ROCKET_Y\n\n        draw-rocket\n        scroll-right\n        draw-rocket\n\n        scroll-direction := 123\n        fill-next-slice\n\n        vf := altitude-step\n        delay := vf\n        \n        loop\n            vf := delay\n            if vf != 0 then\n        again\n\n        if altitude-step != 10 then altitude-step += -3\n        altitude += -1\n        if altitude != 0 then\n    again\n\n    # explode\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n\n    x := 40\n    y := 24\n    draw-ground-explosion\n\n    end-mission unlock-B\n    vf := LAUNCH_FAILED\n;\n\n###### Orbit ##################################################################\n: loop-in-orbit\n    altitude := 0\n    unlock-B\n\n    loop\n        x := ROCKET_X\n        y := ROCKET_Y\n\n        draw-rocket\n        scroll-left\n        draw-rocket\n\n        do-orbit-step\n\n        wait-for-frame\n\n        v0 := 0x6\n        if v0 key then jump start-transfer\n\n        altitude += 1\n        if v0 -key then\n    again\n;\n\n: do-orbit-step\n    i := long orbit-altitude-slices\n    i += altitude\n    load v0\n\n    if v0 == 255 then altitude := 0\n    if v0 != 255 then jump0 orbit-slice-jump\n;\n\n: draw-orbit-slice\n    plane 1\n    x := 124\n    y := 24\n    sprite x y 0\n;\n\n###### Transfer ##################################################################\n: start-transfer\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n\n    i := long transfer-at-altitude\n    i += altitude\n    load transfer-target - transfer-target\n    v0 := transfer-target\n    v0 <<= v0\n    jump0 transfer-jump\n;\n\n: transfer-jump\n    jump return-to-earth\n    jump moon-transfer\n    jump mars-transfer\n    jump saturn-transfer\n\n:macro calculate-transfer-result target short {\n    if total-altitude >= target then transfer-result := TRANSFER_GOOD\n    if total-altitude < target  then transfer-result := TRANSFER_IMPACT\n    if total-altitude < short   then transfer-result := TRANSFER_MISS\n}\n\n: moon-transfer\n    calculate-transfer-result M1 M0\n    jump transfer-loop\n\n: mars-transfer \n    calculate-transfer-result A1 A0\n    jump transfer-loop\n\n: saturn-transfer \n    calculate-transfer-result S1 S0\n    jump transfer-loop\n\n: transfer-loop\n    altitude := 0\n\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n\n    x += -3\n    y += -1\n\n    plane 3\n    i := long blast-tail-1\n    sprite x y 15\n    \n    loop\n        v0 := 0b1\n        v0 &= altitude\n\n        x := ROCKET_X\n        y := ROCKET_Y\n        draw-rocket\n\n        x += -3\n        y += -1\n\n        plane 3\n        if v0 == 0 then i := long blast-tail-1\n        if v0 == 1 then i := long blast-tail-2\n        sprite x y 15\n\n        scroll-left\n\n        if v0 == 0 then i := long blast-tail-2\n        if v0 == 1 then i := long blast-tail-1\n        sprite x y 15\n\n        x := ROCKET_X\n        y := ROCKET_Y\n        draw-rocket\n\n        wait-for-frame\n        altitude += 1\n\n        if altitude != 32 then\n    again\n\n    jump start-approach\n\n: return-to-earth\n    \n;\n\n###### Approach  ##################################################################\n: start-approach\n    altitude := 0\n    x := 124\n    y := 24\n\n    if transfer-target == 1 then i := long moon-far-slice-0\n    if transfer-target == 2 then i := long mars-far-slice-0\n    if transfer-target == 3 then i := long saturn-far-slice-0\n    plane 1\n    sprite x y 0\n    wait-for-frame\n\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    x := 124\n    y := 24\n    plane 3\n    scroll-left\n    if transfer-target == 1 then i := long moon-far-slice-1\n    if transfer-target == 2 then i := long mars-far-slice-1\n    if transfer-target == 3 then i := long saturn-far-slice-1\n    plane 1\n    sprite x y 0\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    wait-for-frame\n\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    x := 124\n    y := 24\n    plane 3\n    scroll-left\n    if transfer-target == 1 then i := long moon-far-slice-2\n    if transfer-target == 2 then i := long mars-far-slice-2\n    if transfer-target == 3 then i := long saturn-far-slice-2\n    plane 1\n    sprite x y 0\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    wait-for-frame\n\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    x := 124\n    y := 24\n    plane 3\n    scroll-left\n    if transfer-target == 1 then i := long moon-far-slice-3\n    if transfer-target == 2 then i := long mars-far-slice-3\n    if transfer-target == 3 then i := long saturn-far-slice-3\n    plane 1\n    sprite x y 0\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n    wait-for-frame\n\n    loop\n        x := ROCKET_X\n        y := ROCKET_Y\n        draw-rocket\n\n        scroll-left\n\n        draw-rocket\n        wait-for-frame\n\n        altitude += 1\n        if altitude != 16 then\n    again\n    \n    if transfer-result == TRANSFER_MISS then jump go-long\n    if transfer-result != TRANSFER_MISS then jump go-land\n\n: go-long\n    altitude := 0\n    #x := ROCKET_X\n    #y := ROCKET_Y\n    #draw-rocket\n\n    x := 48\n    y := 24\n\n    loop\n        if transfer-target == 1 then i := long moon-far-slice-0\n        if transfer-target == 2 then i := long mars-far-slice-0\n        if transfer-target == 3 then i := long saturn-far-slice-0\n        plane 1\n        sprite x y 0\n        plane 3\n        scroll-right\n        plane 1\n        sprite x y 0\n\n        wait-for-frame\n\n        altitude += 1\n        if altitude != 24 then\n    again\n\n    v0 := key\n    end-mission unlock-C\n    jump main\n\n: go-land\n    draw-rocket\n    wait-for-frame\n    wait-for-frame\n\n    clear\n    altitude := 127\n    x := altitude\n    y := ROCKET_Y\n    draw-rocket\n    wait-for-frame\n\n    loop\n        x := altitude\n\n        draw-rocket\n        altitude += -4\n        x := altitude\n        draw-rocket\n        \n        wait-for-frame\n        if altitude != 63 then\n    again\n\n    if transfer-result == TRANSFER_GOOD then jump go-touchdown\n    if transfer-result != TRANSFER_GOOD then jump go-crash\n\n: go-crash\n    plane 1\n    draw-ground\n\n    altitude := 63\n    x := altitude\n    y := ROCKET_Y\n\n    loop\n        draw-rocket\n        altitude -= 4\n        x := altitude\n        draw-rocket\n        wait-for-frame\n\n        if altitude != 3 then\n    again\n\n    draw-rocket\n\n    x := 1\n    y := 24\n    draw-ground-explosion\n;\n\n: go-touchdown\n    plane 1\n    draw-ground\n\n    altitude := 63\n    x := altitude\n    y := ROCKET_Y\n\n    v0 := 0\n    x -= 3\n    y -= 1\n    draw-blast-tail\n\n    loop\n        x := altitude\n        y := ROCKET_Y\n\n        draw-rocket\n        x -= 3\n        y -= 1\n        draw-blast-tail\n        altitude -= 4\n\n        vf := 0b1\n        v0 ^= vf\n\n        x := altitude\n        y += 1\n        draw-rocket\n        x -= 3\n        y -= 1\n        draw-blast-tail\n        \n        wait-for-frame\n\n        if altitude != 3 then\n    again\n\n    draw-blast-tail\n    x += 3\n    y += 1\n    draw-rocket\n    x := 1\n    draw-rocket\n\n    v0 := key\n    if transfer-target == 1 then jump moon-land-unlock\n    if transfer-target == 2 then jump mars-land-unlock\n    jump saturn-land-unlock\n;\n\n: moon-land-unlock\n    end-mission unlock-D\n    jump main\n\n: mars-land-unlock\n    end-mission unlock-E\n    jump main\n\n: saturn-land-unlock\n    plane 3\n    altitude := 0\n\n    loop\n        scroll-left\n        wait-for-frame\n        altitude += 1\n\n        if altitude != 6 then\n    again\n\n    x := 124\n    y := 24\n\n    i := long god-0\n    sprite x y 0\n    wait-for-frame\n\n    scroll-left\n    i := long god-1\n    sprite x y 0\n    wait-for-frame\n\n    scroll-left\n    i := long god-2\n    sprite x y 0\n    wait-for-frame\n\n    scroll-left\n    i := long god-3\n    sprite x y 0\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    scroll-left\n    wait-for-frame\n\n    v0 := key\n    jump main\n;\n\n###### Functions ##################################################################\n\n: wait-for-return-to-menu\n    v0 := key\n    jump main\n\n: explode-on-pad\n    y -= 6\n    x -= 1\n    draw-ground-explosion\n    wait-for-return-to-menu\n;\n\n: draw-ground\n    x := 0\n    y := 0\n    v0 := 0\n\n    loop\n        get-ground-slice\n        v0 += 6\n        y += 8\n        if y != 64 then\n    again\n;\n\n: get-ground-slice\n    jump0 moon-ground-jump\n\n: draw-ground-slice\n    sprite x y 8\n;\n\n:macro loop-calculate-total-altitude start delta temp {\n    temp := start\n    loop\n        while temp != 0\n        i += delta\n        temp += -1\n    again\n}\n\n: calculate-total-altitude\n    # total altitude\n    i := long rocket-data\n    load v3 - v5\n\n    i := long rocket-altitudes\n\n    # first stage\n    v0 := 25\n    loop-calculate-total-altitude v3 v0 v1\n    v0 := 5\n    loop-calculate-total-altitude v4 v0 v1\n    v0 := 1\n    loop-calculate-total-altitude v5 v0 v1\n    load total-altitude - total-altitude\n;\n\n: unlock-B\n    v0 := PROGRESSION_0\n    progress-to-v0\n;\n\n: unlock-C\n    v0 := PROGRESSION_1\n    progress-to-v0\n;\n\n: unlock-D\n    v0 := PROGRESSION_2\n    progress-to-v0\n;\n\n: unlock-E\n    v0 := PROGRESSION_3\n    progress-to-v0\n;\n\n: progress-to-v0\n    i := long builder-progression-step\n    load v1 - v1\n\n    if v0 < v1 then return\n\n    v1 := v0\n    save v1 - v1\n\n    i := long builder-progression\n    i += v0\n    load v5\n\n    i := long builder-data\n    save v5\n;\n\n#: accumulate-drift\n#    v3 := OCTO_KEY_A\n#    if v3 key then jump oppose-drift\n#\n#    v3 := OCTO_KEY_D\n#    if v3 key then jump oppose-drift\n#\n#    full-drift\n#;\n#\n#: oppose-drift\n#    v4 := steering-counter\n#    v4 -= drift-step\n#    drift-counter += v4\n#    if vf == 1 begin \n#        drift-offset -= drift-direction\n#        if vf == 0 begin\n#\n#        end\n#    end\n#;\n#\n#: full-drift\n#    drift-counter += drift-step\n#    if vf == 1 then drift-offset += drift-direction\n#;\n\n: lift-off-draw-rocket\n# plume\n    if x >= 4 begin\n        x += -4\n        y += -1\n        draw-exhaust x y v3\n        x += 4\n    end\n\n# rocket\n    y += 1\n    draw-rocket\n\n    x += 1\n    draw-rocket\n    altitude := x\n;\n\n# set x and y aliases to position\n: draw-rocket\n    plane 3\n\n    # bottom\n    get-stage-data-offset   game-bottom-stage-data-offset draw-rocket-temp vf\n    i := long rocket-stage\n    i += draw-rocket-temp\n    sprite x y 3\n\n    # mid\n    get-stage-x-offset      game-bottom-stage-data-offset draw-rocket-temp\n    x += draw-rocket-temp\n    if x > 127 then return\n    get-stage-data-offset   game-middle-stage-data-offset draw-rocket-temp vf\n    i := long rocket-stage\n    i += draw-rocket-temp\n    sprite x y 3\n\n    # top\n    get-stage-x-offset      game-middle-stage-data-offset draw-rocket-temp\n    x += draw-rocket-temp\n    if x > 127 then return\n    get-stage-data-offset   game-top-stage-data-offset draw-rocket-temp vf\n    i := long rocket-stage\n    i += draw-rocket-temp\n    sprite x y 3\n\n    get-stage-x-offset      game-middle-stage-data-offset draw-rocket-temp\n    x -= draw-rocket-temp\n    get-stage-x-offset      game-bottom-stage-data-offset draw-rocket-temp\n    x -= draw-rocket-temp\n;\n\n: draw-blast-tail\n    plane 3\n    if v0 == 0 then i := long blast-tail-1\n    if v0 == 1 then i := long blast-tail-2\n    sprite x y 15\n;\n\n: draw-blast-tail-reverse\n    plane 3\n    if v0 == 0 then i := long blast-tail-2\n    if v0 == 1 then i := long blast-tail-1\n    sprite x y 15\n;\n\n: draw-ground-explosion\n    plane 2\n\n    i := long ground-explosion-0\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-1\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-2\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-3\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-4\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-5\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-6\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-7\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-8\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-9\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n\n    i := long ground-explosion-10\n    sprite x y 0\n    wait-for-frame\n    sprite x y 0\n;\n\n:macro air-explosion-step X Y frame {\n    i := long frame\n    sprite X Y 0\n    wait-for-frame\n    x += 4\n}\n\n: draw-air-explosion\n    x := ROCKET_X\n    y := ROCKET_Y\n    draw-rocket\n\n    plane 2\n    y += -7\n\n    air-explosion-step x y air-explosion-0\n    air-explosion-step x y air-explosion-1\n    air-explosion-step x y air-explosion-2\n    air-explosion-step x y air-explosion-3\n    air-explosion-step x y air-explosion-4\n    air-explosion-step x y air-explosion-5\n    air-explosion-step x y air-explosion-6\n    air-explosion-step x y air-explosion-7\n    air-explosion-step x y air-explosion-8\n    air-explosion-step x y air-explosion-9\n\n    wait-for-return-to-menu\n;\n\n: wait-for-frame\n    vf := 10\n    delay := vf\n    \n    loop\n        vf := delay\n        if vf != 0 then\n    again\n;\n\n: draw-game-start-scene\n    plane 1\n\n    i := long ground-trees\n    v0 := 0\n    v1 := 0\n    sprite v0 v1 15\n\n    i := long ground-plane\n    v1 := 15\n    sprite v0 v1 15\n\n    i := long ground-launcher\n    v1 := 30\n    sprite v0 v1 15\n\n    i := long ground-trees\n    v1 := 45\n    sprite v0 v1 15\n\n    i := long ground-plane\n    v1 := 60\n    sprite v0 v1 15\n\t\t\n    i := long will-draw-logo\n    load ve - ve\n\n    x := 8\n    y := 0\n    i := long sky-full\n\n    loop\n        loop\n            sprite x y 15\n            y += 15\n\n            if ve == 0 then draw-cloud\n            if y != 75 then\n        again\n\n        x += 8\n        y := 0\n\n        if x != 128 then\n    again\n\n    if ve == 1 then draw-logo\n;\n\n: draw-logo\n    x := 80\n    y := 8\n    i := long logo-00\n    sprite x y 0\n\n    y += 15\n    i := long logo-01\n    sprite x y 0\n\n    x += -6\n    y := 8\n    i := long logo-10\n    sprite x y 15\n\n    y += 15\n    i := long logo-11\n    sprite x y 15\n\n    y += 15\n    i := long logo-12\n    sprite x y 15\n\n    ve := 0\n    i := long will-draw-logo\n    save ve - ve\n;\n\n: draw-cloud\n    if x > 64 begin\n        v0 := random 0b111\n        if v0 == 0 begin\n            i := long cloud-1\n            \n            plane 2\n            sprite x y 15\n            plane 1\n            sprite x y 15\n            \n            i := long sky-full\n        end\n    end\n;\n\n: fill-next-slice\n    if scroll-direction != 123 then i := long next-slice-index-table\n    if scroll-direction == 123 then i := long previous-slice-index-table\n    i += altitude\n\n    load v0\n    jump0 select-sky-jump\n; \n\n: fill-orbit-slice\n\n;\n \n: draw-sky-slice\n    if scroll-direction != 123 then x := 124\n    if scroll-direction == 123 then x := 0\n    y := 0\n    plane 1\n\n    loop\n        sprite x y 15\n\n        y += 15\n        if y != 75 then\n    again\n;\n\n: select-sky-jump\n    jump use-sky-1\n    jump use-sky-2\n    jump use-sky-2\n    jump use-sky-3\n    jump use-sky-3\n    jump use-sky-4\n    jump use-sky-4\n    jump use-sky-5\n;\n\n: use-sky-1     i := long sky-1 jump draw-sky-slice\n: use-sky-2     i := long sky-2 jump draw-sky-slice\n: use-sky-3     i := long sky-3 jump draw-sky-slice\n: use-sky-4     i := long sky-4 jump draw-sky-slice\n: use-sky-5     i := long sky-5 jump draw-sky-slice\n\n: step-launch-smoke\n    if launch-step == LAUNCH_STEP_COUNT then return\n\n    v1 := 254\n    pick-launch-smoke\n    v1 := 255\n    pick-launch-smoke\n    launch-step += 1\n    v1 := 254\n    pick-launch-smoke\n    v1 := 255\n    pick-launch-smoke\n;\n\n: pick-launch-smoke\n    v0 := launch-step\n    v0 <<= v0\n    jump0 select-launch-smoke\n;\n\n: select-launch-smoke\n    jump use-launch-smoke-1\n    jump use-launch-smoke-1\n    jump use-launch-smoke-2\n    jump use-launch-smoke-2\n    jump use-launch-smoke-3\n    jump use-launch-smoke-3\n    jump use-launch-smoke-4\n    jump use-launch-smoke-4\n    jump use-launch-smoke-5\n    jump use-launch-smoke-5\n    jump use-launch-smoke-6\n    jump use-launch-smoke-6\n    jump use-launch-smoke-7\n    jump use-launch-smoke-7\n    jump use-launch-smoke-8\n    jump use-launch-smoke-8\n    jump use-launch-smoke-9\n    jump use-launch-smoke-9\n    jump use-launch-smoke-10\n    jump use-launch-smoke-10\n;\n\n: use-launch-smoke-1 \n    if v1 == 254 then i := long launch-smoke-left-1 \n    if v1 == 255 then i := long launch-smoke-right-1 \n    jump draw-launch-smoke\n    \n: use-launch-smoke-2 \n    if v1 == 254 then i := long launch-smoke-left-2 \n    if v1 == 255 then i := long launch-smoke-right-2 \n    jump draw-launch-smoke\n    \n: use-launch-smoke-3 \n    if v1 == 254 then i := long launch-smoke-left-3 \n    if v1 == 255 then i := long launch-smoke-right-3 \n    jump draw-launch-smoke\n\n: use-launch-smoke-4 \n    if v1 == 254 then i := long launch-smoke-left-4 \n    if v1 == 255 then i := long launch-smoke-right-4 \n    jump draw-launch-smoke\n\n: use-launch-smoke-5 \n    if v1 == 254 then i := long launch-smoke-left-5 \n    if v1 == 255 then i := long launch-smoke-right-5 \n    jump draw-launch-smoke\n\n: use-launch-smoke-6 \n    if v1 == 254 then i := long launch-smoke-left-6 \n    if v1 == 255 then i := long launch-smoke-right-6 \n    jump draw-launch-smoke\n\n: use-launch-smoke-7 \n    if v1 == 254 then i := long launch-smoke-left-7 \n    if v1 == 255 then i := long launch-smoke-right-7 \n    jump draw-launch-smoke\n\n: use-launch-smoke-8 \n    if v1 == 254 then i := long launch-smoke-left-8 \n    if v1 == 255 then i := long launch-smoke-right-8 \n    jump draw-launch-smoke\n\n: use-launch-smoke-9 \n    if v1 == 254 then i := long launch-smoke-left-9 \n    if v1 == 255 then i := long launch-smoke-right-9 \n    jump draw-launch-smoke\n\n: use-launch-smoke-10 \n    if v1 == 254 then  i := long launch-smoke-left-10 \n    if v1 == 255 then  i := long launch-smoke-right-10 \n    jump draw-launch-smoke\n\n: draw-launch-smoke\n    plane 2\n    if v1 == 254 then y := SMOKE_LEFT\n    if v1 == 255 then y := SMOKE_RIGHT\n    x := 1\n    sprite x y 15\n;\n\n: stage-bottom-jump\n    i := long stage-bottom-short-thin-1     jump draw-bottom-stage\n    i := long stage-bottom-tall-thin-1      jump draw-bottom-stage\n    i := long stage-bottom-short-fat-1      jump draw-bottom-stage\n    i := long stage-bottom-tall-fat-1       jump draw-bottom-stage\n\n: stage-middle-jump\n    i := long stage-middle-none             jump draw-middle-stage\n    i := long stage-middle-short-thin-1     jump draw-middle-stage\n    i := long stage-middle-tall-thin-1      jump draw-middle-stage\n    i := long stage-middle-short-fat-1      jump draw-middle-stage\n    i := long stage-middle-tall-fat-1       jump draw-middle-stage\n\n: stage-top-jump\n    i := long stage-top-none             jump draw-top-stage\n    i := long stage-top-short-thin-1     jump draw-top-stage\n    i := long stage-top-tall-thin-1      jump draw-top-stage\n    i := long stage-top-short-fat-1      jump draw-top-stage\n    i := long stage-top-tall-fat-1       jump draw-top-stage\n\n: orbit-slice-jump\n    i := long orbit-blank           jump draw-orbit-slice\n    i := long moon-far-slice-0      jump draw-orbit-slice\n    i := long moon-far-slice-1      jump draw-orbit-slice\n    i := long moon-far-slice-2      jump draw-orbit-slice\n    i := long moon-far-slice-3      jump draw-orbit-slice\n    i := long mars-far-slice-0      jump draw-orbit-slice\n    i := long mars-far-slice-1      jump draw-orbit-slice\n    i := long mars-far-slice-2      jump draw-orbit-slice\n    i := long saturn-far-slice-0    jump draw-orbit-slice\n    i := long saturn-far-slice-1    jump draw-orbit-slice\n    i := long saturn-far-slice-2    jump draw-orbit-slice\n    i := long saturn-far-slice-3    jump draw-orbit-slice\n\n: moon-ground-jump\n    i := long ground-moon-1         jump draw-ground-slice\n    i := long ground-moon-2         jump draw-ground-slice\n    i := long ground-moon-3         jump draw-ground-slice\n    i := long ground-moon-4         jump draw-ground-slice\n    i := long ground-moon-5         jump draw-ground-slice\n    i := long ground-moon-6         jump draw-ground-slice\n    i := long ground-moon-7         jump draw-ground-slice\n    i := long ground-moon-8         jump draw-ground-slice\n\n: ground-plane 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F\n: ground-trees 0x7F 0x57 0x0F 0x6F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x4F 0x07 0x4F 0x7F\n: ground-launcher 0x3F 0x3F 0x39 0x01 0x7F 0x3F 0x3F 0x3F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F\n: ground-pad 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x7F 0x3F 0x3F\n\n: ground-moon-1 0x80 0xE0 0xF0 0xE0 0xC0 0xC0 0x80 0x80\n: ground-moon-2 0x80 0xC0 0xA0 0xA0 0x90 0xD0 0xC8 0x84\n: ground-moon-3 0xFC 0xF8 0xF0 0xE0 0xC0 0xE0 0xE0 0xC0\n: ground-moon-4 0xE0 0xF0 0xE0 0xC0 0x80 0x80 0x80 0x80\n: ground-moon-5 0x80 0x80 0x80 0xC0 0xA0 0xC0 0xA0 0x90\n: ground-moon-6 0x98 0xF8 0xB0 0xA0 0xE0 0xE0 0xC0 0x80\n: ground-moon-7 0xC0 0xE0 0xE0 0xC0 0xE0 0xB0 0x98 0x88\n: ground-moon-8 0xC8 0xF0 0xE0 0xC0 0xE0 0xE0 0xC0 0x80\n\n: rocket-stage\n    0x00 0x00 0x00 0x00 0x00 0x00   # none (0)\n    0x00 0xC0 0x00 0x00 0xC0 0x00   # short thin (6)\n    0x00 0xF0 0x00 0x00 0xF0 0x00   # long-thin (12)\n    0xC0 0xC0 0xC0 0xC0 0xC0 0xC0   # short-fat (18)\n    0xF0 0xF0 0xF0 0xF0 0xF0 0xF0\n\n# jump index to which sky to use for each altitude value\n: next-slice-index-table\n    0  0  0  0  0  0  0  0  #0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  \n    2  2  2  2  2  2  2  2  #2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  \n    4  4  4  4  4  4  4  4  #4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  4  \n    6  6  6  6  6  6  6  6  #6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  \n    8  8  8  8  8  8  8  8  #8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  8  \n    10 10 10 10 10 10 10 10 #10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 \n    12 12 12 12 12 12 12 12 #12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 \n    14 14 14 14 14 14 14 14 14 #14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14\n\n: previous-slice-index-table\n    14 14 14 14 14 14 14 14\n    14 14 14 0  0  0  0  0\n    0  0  0  0  0  0  0  0\n    0  0  0  0  0  0  0  0\n    0  0  0  0  0  0  0  0\n    0  0  0  0  0  0  0  0\n    0  0  0  0  0  0  0  0\n    0  0  0  0  0  0  0  0  \n    2  2  2  2  2  2  2  2  \n    4  4  4  4  4  4  4  4  \n    6  6  6  6  6  6  6  6  \n    8  8  8  8  8  8  8  8\n\n: sky-full 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF\n: sky-1 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0\n: sky-2 0x70 0xF0 0x70 0xF0 0xB0 0xF0 0xB0 0xF0 0xD0 0xF0 0xD0 0xF0 0xF0 0xE0 0xF0\n: sky-3 0x70 0xD0 0x70 0xD0 0xB0 0xE0 0xB0 0xE0 0xD0 0x70 0xD0 0x70 0xE0 0xB0 0xE0\n: sky-4 0x10 0x20 0x10 0x20 0x10 0x80 0x10 0x80 0x40 0x80 0x40 0x80 0x40 0x20 0x40\n: sky-5 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: next-orbit-slice-index-table\n    0 0 0 0 0 0 0 0 2 4 6 8 10 12 14\n;\n\n: cloud-1 0x80 0xC0 0xA0 0x90 0x88 0x88 0x88 0x90 0x98 0xA4 0xC2 0x82 0x84 0x98 0xE0\n\n: launch-smoke-left-1  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0xE0 0xC0 0x80\n: launch-smoke-left-2  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x30 0x68 0xC8 0x90 0xA0 0xC0 0x80\n: launch-smoke-left-3  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x38 0x6C 0xD2 0xAD 0x52 0xCC 0x80 0x80\n: launch-smoke-left-4  0x00 0x00 0x00 0x00 0x30 0x58 0xA8 0xFC 0xEC 0xD8 0xA8 0x50 0xE0 0x80 \n: launch-smoke-left-5  0x00 0x50 0xE4 0x70 0xB0 0x58 0xB0 0xF4 0x60 0xE8 0xA0 0x50 0x80 0xC0 \n: launch-smoke-left-6  0x00 0x48 0x80 0x28 0x82 0x58 0x20 0x74 0x60 0xF8 0xAC 0x74 0xBC 0xC0 \n: launch-smoke-left-7  0x80 0x24 0x08 0x01 0x88 0x42 0x38 0x4C 0xD6 0xA2 0xFA 0xCE 0x80 0xC0 \n: launch-smoke-left-8  0xA4 0x11 0x40 0x80 0xD0 0x72 0xB8 0x54 0xF4 0xB0 0x50 0xE0 0x80 0x40 \n: launch-smoke-left-9  0xA2 0x10 0x48 0x80 0xC9 0x60 0x81 0x42 0xC0 0xA8 0x00 0x90 0x80 0x40 \n: launch-smoke-left-10 0x28 0x90 0x44 0x20 0x02 0xA0 0x10 0x00 0x80 0x40 0x00 0xA0 0x00 0x40 \n\n: launch-smoke-right-1  0x80 0xC0 0xE0 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00  \n: launch-smoke-right-2  0x80 0xC0 0xA0 0x90 0xC8 0x68 0x30 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 \n: launch-smoke-right-3  0x80 0x80 0xCC 0x52 0xAD 0xD2 0x6C 0x38 0x00 0x00 0x00 0x00 0x00 0x00 0x00 \n: launch-smoke-right-4  0x80 0xE0 0x50 0xA8 0xD8 0xEC 0xFC 0xA8 0x58 0x30 0x00 0x00 0x00 0x00   \n: launch-smoke-right-5  0xC0 0x80 0x50 0xA0 0xE8 0x60 0xF4 0xB0 0x58 0xB0 0x70 0xE4 0x50 0x00   \n: launch-smoke-right-6  0xC0 0xBC 0x74 0xAC 0xF8 0x60 0x74 0x20 0x58 0x82 0x28 0x80 0x48 0x00   \n: launch-smoke-right-7  0xC0 0x80 0xCE 0xFA 0xA2 0xD6 0x4C 0x38 0x42 0x88 0x01 0x08 0x24 0x80   \n: launch-smoke-right-8  0x40 0x80 0xE0 0x50 0xB0 0xF4 0x54 0xB8 0x72 0xD0 0x80 0x40 0x11 0xA4   \n: launch-smoke-right-9  0x40 0x80 0x90 0x00 0xA8 0xC0 0x42 0x81 0x60 0xC9 0x80 0x48 0x10 0xA2   \n: launch-smoke-right-10 0x40 0x00 0xA0 0x00 0x40 0x80 0x00 0x10 0xA0 0x02 0x20 0x44 0x90 0x28\n\n: blast-tail-1 0x00 0x20 0xC0 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x20 0xC0 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: blast-tail-2 0x20 0x40 0x80 0x40 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x20 0x40 0x80 0x40 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: exhaust-plume-1 0x40 0xB0 0x60 0x90 0x40\n: exhaust-plume-2 0x40 0x90 0x60 0xB0 0x40\n: exhaust-plume-3 0x60 0xB0 0x80 0x10 0x80\n: exhaust-plume-4 0x20 0x30 0x80 0x30 0xA0\n\n# num bottom stages | unlocked bottom | num middle stages | unlocked middle | num top stages | unlocked top\n#: builder-data 4 1 5 0 5 0  # A\n: builder-data 4 3 5 3 5 2  # C\n#: builder-data 4 4 5 5 5 5  # E\n\n: total-mission-count       0\n: builder-progression-step  6#0\n: builder-progression  \n    4 2 5 2 5 0 # B i + 0\n    4 3 5 3 5 2 # C i + 6\n    4 4 5 4 5 4 # D i + 12\n    4 4 5 5 5 5 # E i + 18\n\n# bottom stage | middle stage | top stage\n: rocket-data 0 0 0\n\n# jump offset | world x offset | altitudes x/y/z\n: bottom-stage-data\n    0  2 10 0 0 0 0 0 \n    6  4 20 1 0 0 0 0 \n    12 2 30 2 0 0 0 0 \n    18 4 40 3 0 0 0 0 \n: middle-stage-data\n    0  0 0  0 0 0 0 0 # no stage\n    6  2 10 1 0 0 0 0\n    12 4 20 2 0 0 0 0\n    18 2 30 3 0 0 0 0\n    24 4 40 4 0 0 0 0\n: top-stage-data\n    0  0 0  0 0 0 0 0 # no stage\n    6  2 10 1 0 0 0 0\n    12 4 20 2 0 0 0 0\n    18 2 30 3 0 0 0 0\n    24 4 40 4 0 0 0 0\n\n# stages = XYZ\n# X: X * 25 \n# Y: X + Y * 5\n# Z: X + Y + Z \n#   100 101 102 103 104\n#   110 111 112 113 114\n#   120 121 122 123 124\n#   130 131 132 133 134\n#   140 141 142 143 144\n# etc\n: rocket-altitudes\n    # 20 0 | 45 0 | 30 0 | 60 0\n    # 40 10 | 60 20 | 50 15 | 80 25\n    # 70 20 | 140 30 | 100 25 | 180 40\n    200 100 100 100 100 # s1\n    202 2   3   3   102 \n    2   2   103 102 101 \n    2   3   104 4   102 \n    102 101 101 101 101 \n    201 100 100 100 100 # s2\n    1   2   3   103 102 \n    2   3   5   4   102 \n    4   103 104 4   101 \n    102 101 101 101 101  \n    201 100 100 100 100 # s3\n    1   2   104 103 102 \n    2   104 103 102 101 \n    1   2   3   4   5   \n    2   3   103 4   6   \n    4   100 100 100 100 # s4\n    2   3   103 4   102 \n    3   4   3   103 101 \n    4   104 5   4   6   \n    5   6   103 6   7  \n#:monitor rocket-altitudes \"100:%1i\\n101:%1i\\n102:%1i\\n103:%1i\\n104:%1i\"\n\n: builder-ui-dot 0x80\n: builder-ui-arrow 0x18 0x18 0x99 0xDB 0x7E 0x3C 0x18\n\n: stage-bottom-short-thin-1   0x00 0x00 0x00 0x00 0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-bottom-tall-thin-1    0x00 0x00 0x00 0x00 0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-bottom-short-fat-1    0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x81 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-bottom-tall-fat-1     0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x80 0x01 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: stage-middle-none           0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-middle-short-thin-1   0x00 0x00 0x00 0x00 0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-middle-tall-thin-1    0x00 0x00 0x00 0x00 0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-middle-short-fat-1    0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x81 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-middle-tall-fat-1     0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x80 0x01 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: stage-top-none           0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-top-short-thin-1   0x00 0x00 0x00 0x00 0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-top-tall-thin-1    0x00 0x00 0x00 0x00 0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-top-short-fat-1    0x7F 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x81 0x00 0x81 0x00 0xFF 0x00 0x81 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: stage-top-tall-fat-1     0x7F 0xFF 0x80 0x01 0xFF 0xFF 0x80 0x01 0x80 0x01 0x80 0x01 0xFF 0xFF 0x80 0x01 0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: ground-explosion-0  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x00 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: ground-explosion-1  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x00 0x20 0x00 0x20 0x00 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: ground-explosion-2  0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00 0x60 0x00 0x10 0x00 0x88 0x00 0x88 0x00 0x10 0x00 0x60 0x00 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: ground-explosion-3 0x00 0x00 0x00 0x00 0x00 0x00 0xE0 0x00 0x18 0x00 0x04 0x00 0x82 0x00 0xC2 0x00 0x42 0x00 0x82 0x00 0x04 0x00 0x18 0x00 0xE0 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: ground-explosion-4 0x00 0x00 0x00 0x00 0xF0 0x00 0x0E 0x00 0x01 0x00 0x48 0x80 0xE0 0x80 0xA0 0x40 0x60 0x40 0xD0 0x80 0x40 0x80 0x81 0x00 0x0E 0x00 0xF0 0x00 0x00 0x00 0x00 0x00\n: ground-explosion-5 0x00 0x00 0xF8 0x00 0x07 0x00 0x82 0xC0 0x84 0x20 0x50 0x10 0xF0 0x08 0xF8 0x08 0xAC 0x08 0xD8 0x08 0x5C 0x10 0xA2 0x20 0x00 0xC0 0x07 0x00 0xF8 0x00 0x00 0x00\n: ground-explosion-6 0x0C 0x20 0x03 0xC0 0x80 0x30 0xC0 0x0C 0x74 0x02 0x58 0x82 0xF4 0x02 0x7E 0x01 0xAF 0x01 0xDB 0x02 0x5F 0x12 0xB6 0x02 0xFC 0x0C 0xB0 0x30 0x43 0xC0 0x0C 0x00\n: ground-explosion-7 0x00 0xF8 0x00 0x06 0x80 0x01 0xC3 0xE0 0xA6 0x18 0xF4 0x88 0xDD 0xE8 0xFD 0xD8 0xEF 0x38 0xFB 0x68 0x5F 0xD0 0xA7 0x70 0xC1 0xC0 0x80 0x01 0x00 0x06 0x00 0xF8\n: ground-explosion-8 0xC0 0x00 0xA0 0x00 0xE0 0x70 0x40 0xEC 0xA0 0x1E 0xA2 0x8A 0x53 0xEA 0x7D 0xDA 0x8F 0x3A 0xFB 0x6A 0x53 0xD2 0xA0 0x72 0xC0 0xFE 0x40 0x38 0x60 0x00 0xC0 0x00\n: ground-explosion-9 0x00 0x00 0x20 0x78 0xE0 0x5C 0x00 0x46 0x20 0x1E 0xA0 0x02 0x50 0x0E 0x6C 0x02 0x84 0x03 0xD8 0x0B 0x50 0x53 0xA0 0x0E 0x40 0x96 0x80 0xF8 0xC0 0x20 0x40 0x00\n: ground-explosion-10 0x80 0x58 0x00 0x50 0xC0 0x0C 0x00 0x08 0x80 0x1C 0xA0 0x02 0x90 0x0C 0x40 0x02 0x00 0x01 0x80 0x08 0xC0 0x10 0x80 0x08 0x40 0x12 0x00 0x08 0x40 0x28 0x00 0x70\n\n: air-explosion-0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: air-explosion-1 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x40 0x00 0x80 0x00 0xA0 0x00 0x40 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: air-explosion-2 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x20 0x00 0x10 0x00 0x40 0x00 0xC4 0x00 0x00 0x00 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: air-explosion-3 0x00 0x00 0x00 0x00 0x00 0x00 0x10 0x00 0x04 0x00 0x00 0x00 0x70 0x00 0xE0 0x00 0xBC 0x80 0x68 0x00 0x10 0x00 0x00 0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: air-explosion-4 0x00 0x00 0x08 0x00 0x01 0x00 0x00 0x00 0x38 0x00 0x69 0x00 0x74 0x00 0xDC 0x00 0xFE 0x00 0x76 0x10 0x5E 0x00 0x3C 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00\n: air-explosion-5 0x00 0x40 0x04 0x00 0x00 0x00 0x06 0x00 0x3B 0x10 0x79 0x80 0x74 0xC0 0x5F 0x60 0xFF 0x20 0xD6 0x40 0xEE 0xC0 0x73 0x80 0x3D 0x84 0x1F 0x00 0x00 0x00 0x00 0x80\n: air-explosion-6 0x00 0x00 0x00 0x04 0x07 0x00 0x03 0xC0 0x83 0x40 0xC1 0xE0 0xF4 0xF0 0x5F 0xF0 0xFB 0xA0 0x66 0xC0 0xFE 0xC0 0x6D 0xA0 0xBF 0xA0 0xC7 0x60 0x01 0xC1 0x00 0x00\n: air-explosion-7 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x00 0x40 0x01 0xEE 0x04 0xDE 0x0F 0xC7 0x3B 0xFB 0x66 0xF3 0x3E 0xDE 0x2D 0xA0 0x1F 0xA0 0x07 0x60 0x01 0xC0 0x00 0x00\n: air-explosion-8 0x00 0x00 0x00 0x00 0x00 0x10 0x00 0x80 0x04 0x00 0x21 0x00 0x04 0xDA 0x0F 0x40 0x3B 0xF8 0x67 0xF1 0x3E 0xD8 0x17 0xA0 0x13 0x80 0x1E 0x00 0x0D 0x40 0x00 0x00\n: air-explosion-9 0x00 0x00 0x00 0x40 0x00 0x00 0x04 0x00 0x00 0x00 0x21 0x00 0x04 0x4A 0x09 0x40 0x18 0x10 0x44 0x81 0x02 0x48 0x10 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x00 0x00\n\n: orbit-altitude-slices\n    0  0  0  0  0  0   #0\n    0  0  0  0  0  0   #1\n    6  12 18 24        # moon\n    0  0  0  0  0  0   #3\n    0  0  0  0  0  0   #4\n    0  0  0  0  0  0   #5\n    0  0  0  0  0  0   #6\n    30 36 42           # mars\n    0  0  0  0  0  0   #8\n    0  0  0  0  0  0   #9\n    0  0  0  0  0  0   #10\n    0  0  0  0  0  0   #11\n    48 54 60 66        # saturn\n    0  0  0  0  0  0   #12\n    0  0  0  0  0  0   #13\n    0  0  0  0  0  0   #14\n    0  0  0  0  0  0   #15\n    255\n\n: transfer-at-altitude\n    0  0  0  0  0  0   #0\n    0  0  0  0  0  0   #1\n    1  1  1  1         # moon\n    1  1  1  1  1  1   #3\n    1  1  1  1  1  1   #4\n    1  1  1  1  1  1   #5\n    1  1  1  1  1  1   #6\n    2  2  2            # mars\n    2  2  2  2  2  2   #8\n    2  2  2  2  2  2   #9\n    2  2  2  2  2  2   #10\n    2  2  2  2  2  2   #11\n    3  3  3  3         # saturn\n    3  3  3  3  3  3   #12\n    3  3  3  3  3  3   #13\n    3  3  3  3  3  3   #14\n    3  3  3  3  3  3   #15\n\n: orbit-blank 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: moon-far-slice-0 0x00 0x00 0x00 0x00 0x03 0xC0 0x0E 0xF0 0x1F 0x58 0x1D 0xF8 0x38 0xFC 0x31 0x64 0x3B 0xC4 0x3F 0xA4 0x16 0x08 0x1C 0x98 0x0E 0x70 0x03 0xC0 0x00 0x00 0x00 0x00\n: moon-far-slice-1 0x00 0x00 0x00 0x00 0x3C 0x00 0xEF 0x00 0xF5 0x81 0xDF 0x81 0x8F 0xC3 0x16 0x43 0xBC 0x43 0xFA 0x43 0x60 0x81 0xC9 0x81 0xE7 0x00 0x3C 0x00 0x00 0x00 0x00 0x00\n: moon-far-slice-2 0x00 0x00 0x00 0x00 0xC0 0x03 0xF0 0x0E 0x58 0x1F 0xF8 0x1D 0xFC 0x38 0x64 0x31 0xC4 0x3B 0xA4 0x3F 0x08 0x16 0x98 0x1C 0x70 0x0E 0xC0 0x03 0x00 0x00 0x00 0x00\n: moon-far-slice-3 0x00 0x00 0x00 0x00 0x00 0x3C 0x00 0xEF 0x81 0xF5 0x81 0xDF 0xC3 0x8F 0x43 0x16 0x43 0xBC 0x43 0xFA 0x81 0x60 0x81 0xC9 0x00 0xE7 0x00 0x3C 0x00 0x00 0x00 0x00\n\n: mars-far-slice-0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03 0xC0 0x07 0xE0 0x0F 0xB0 0x0F 0x50 0x0B 0xF0 0x0D 0xF0 0x07 0xE0 0x03 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: mars-far-slice-1 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3C 0x00 0x7E 0x00 0xFB 0x00 0xF5 0x00 0xBF 0x00 0xDF 0x00 0x7E 0x00 0x3C 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: mars-far-slice-2 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x03 0xE0 0x07 0xB0 0x0F 0x50 0x0F 0xF0 0x0B 0xF0 0x0D 0xE0 0x07 0xC0 0x03 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: mars-far-slice-3 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: saturn-far-slice-0 0x00 0x00 0x00 0x00 0x18 0x00 0x1C 0x00 0x0D 0xC0 0x05 0xE0 0x0B 0xF0 0x0B 0xF0 0x0D 0xF0 0x0E 0xF0 0x07 0x60 0x03 0xB0 0x00 0x38 0x00 0x18 0x00 0x00 0x00 0x00\n: saturn-far-slice-1 0x00 0x00 0x00 0x00 0x80 0x01 0xC0 0x01 0xDC 0x00 0x5E 0x00 0xBF 0x00 0xBF 0x00 0xDF 0x00 0xEF 0x00 0x76 0x00 0x3B 0x00 0x03 0x80 0x01 0x80 0x00 0x00 0x00 0x00\n: saturn-far-slice-2 0x00 0x00 0x00 0x00 0x00 0x18 0x00 0x1C 0xC0 0x0D 0xE0 0x05 0xF0 0x0B 0xF0 0x0B 0xF0 0x0D 0xF0 0x0E 0x60 0x07 0xB0 0x03 0x38 0x00 0x18 0x00 0x00 0x00 0x00 0x00\n: saturn-far-slice-3 0x00 0x00 0x00 0x00 0x01 0x80 0x01 0xC0 0x00 0xDC 0x00 0x5E 0x00 0xBF 0x00 0xBF 0x00 0xDF 0x00 0xEF 0x00 0x76 0x00 0x3B 0x80 0x03 0x80 0x01 0x00 0x00 0x00 0x00\n\n: simple-circle 0x00 0x00 0x00 0x00 0x03 0xC0 0x0F 0xF0 0x1F 0xF8 0x1F 0xF8 0x3F 0xFC 0x3F 0xFC 0x3F 0xFC 0x3F 0xFC 0x1F 0xF8 0x1F 0xF8 0x0F 0xF0 0x03 0xC0 0x00 0x00 0x00 0x00\n\n: will-draw-logo 1\n\n: logo-00 0x09 0x1E 0x12 0xA1 0x14 0xA1 0x09 0x1E 0x00 0x00 0x1F 0x1E 0x04 0xA1 0x04 0xA1 0x03 0x12 0x00 0x00 0x1F 0x01 0x02 0xBF 0x02 0x81 0x1F 0x01 0x00 0x00 0x00 0x00\n: logo-01 0x0F 0x1E 0x10 0xA1 0x10 0xA1 0x09 0x1E 0x00 0x00 0x0F 0x00 0x12 0x80 0x12 0x80 0x10 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: logo-10 0x3E 0x09 0x09 0x06 0x00 0x3E 0x09 0x19 0x26 0x00 0x1E 0x21 0x21 0x1E 0x00\n: logo-11 0x1E 0x21 0x29 0x1A 0x00 0x3E 0x09 0x19 0x26 0x00 0x3E 0x05 0x05 0x3E 0x00\n: logo-12 0x3E 0x01 0x06 0x01 0x01 0x3E 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: god-0 0x00 0x00 0x03 0xFC 0xFE 0x3E 0xFC 0x1F 0xE4 0x1F 0x84 0x1F 0x86 0x3F 0x87 0xFF 0x87 0xFF 0x87 0xFE 0x87 0x8E 0x97 0x04 0xFF 0x00 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0xC0 0x02 0xE0 0x1B 0xE0 0x4B 0xE0 0x49 0xC0 0x48 0x00 0x48 0x00 0x48 0x00 0x48 0x70 0x68 0xF8 0x00 0xF8 0x00 0xD8 0x00 0xF0 0x00 0x00\n: god-1 0x00 0x00 0x3F 0xC0 0xE3 0xEF 0xC1 0xFF 0x41 0xFE 0x41 0xF8 0x63 0xF8 0x7F 0xF8 0x7F 0xF8 0x7F 0xE8 0x78 0xE8 0x70 0x49 0xF0 0x0F 0xF0 0x0F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x1C 0x00 0x2E 0x00 0xBE 0x01 0xBE 0x04 0x9C 0x04 0x80 0x04 0x80 0x04 0x80 0x04 0x87 0x04 0x8F 0x86 0x0F 0x80 0x0D 0x80 0x0F 0x00 0x00 0x00\n: god-2 0x00 0x00 0xFC 0x03 0x3E 0xFE 0x1F 0xFC 0x1F 0xE4 0x1F 0x84 0x3F 0x86 0xFF 0x87 0xFF 0x87 0xFE 0x87 0x8E 0x87 0x04 0x97 0x00 0xFF 0x00 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x01 0xE0 0x02 0xE0 0x1B 0xE0 0x4B 0xC0 0x49 0x00 0x48 0x00 0x48 0x00 0x48 0x70 0x48 0xF8 0x68 0xF8 0x00 0xD8 0x00 0xF0 0x00 0x00 0x00\n: god-3 0x00 0x00 0xC0 0x3F 0xEF 0xE3 0xFF 0xC1 0xFE 0x41 0xF8 0x41 0xF8 0x63 0xF8 0x7F 0xF8 0x7F 0xE8 0x7F 0xE8 0x78 0x49 0x70 0x0F 0xF0 0x0F 0xF0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x1C 0x00 0x2E 0x01 0xBE 0x04 0xBE 0x04 0x9C 0x04 0x80 0x04 0x80 0x04 0x80 0x04 0x87 0x86 0x8F 0x80 0x0F 0x80 0x0D 0x00 0x0F 0x00 0x00","options":{"tickrate":200,"fillColor":"#00aeff","fillColor2":"#fff","blendColor":"#fff","backgroundColor":"#000d14","buzzColor":"#000d14","quietColor":"#000000","shiftQuirks":false,"loadStoreQuirks":false,"vfOrderQuirks":false,"clipQuirks":true,"vBlankQuirks":false,"jumpQuirks":false,"screenRotation":270,"maxSize":"65024","touchInputMode":"none","logicQuirks":false,"fontStyle":"octo","displayScale":"4"},"rom":[240,0,24,165,94,227,78,0,34,14,35,186,0,238,0,255,102,0,99,0,100,0,101,0,240,0,16,199,87,195,34,250,35,16,35,38,34,102,241,10,65,6,18,50,34,58,18,38,0,238,240,0,16,231,83,82,0,238,128,96,65,7,178,126,65,9,178,134,65,5,18,78,65,8,18,90,0,238,34,102,118,2,70,6,102,0,34,102,0,238,34,102,118,254,70,254,102,4,34,102,0,238,70,0,97,24,70,2,97,64,70,4,97,104,98,4,240,0,17,191,241,1,209,39,0,238,18,142,18,178,18,214,0,238,18,162,18,198,18,234,0,238,72,0,0,238,34,250,115,255,51,255,18,158,131,128,115,255,34,250,0,238,72,0,0,238,34,250,115,1,147,128,99,0,34,250,0,238,74,0,0,238,35,16,116,255,52,255,18,194,132,160,116,255,35,16,0,238,74,0,0,238,35,16,116,1,148,160,100,0,35,16,0,238,76,0,0,238,35,38,117,255,53,255,18,230,133,192,117,255,35,38,0,238,76,0,0,238,35,38,117,1,149,192,101,0,35,38,0,238,128,48,128,14,128,14,128,14,240,0,16,234,240,30,93,227,128,208,188,216,0,238,128,64,128,14,128,14,128,14,240,0,17,10,240,30,93,227,128,208,188,240,0,238,128,80,128,14,128,14,128,14,240,0,17,50,240,30,93,227,128,208,189,14,0,238,97,24,98,18,241,1,209,32,113,12,98,36,96,0,144,128,19,100,240,0,17,190,209,33,80,48,19,94,242,1,209,33,241,1,114,2,112,1,19,74,0,238,97,64,98,18,241,1,209,32,113,12,98,36,96,0,144,160,19,142,240,0,17,190,209,33,80,64,19,136,242,1,209,33,241,1,114,2,112,1,19,116,0,238,97,104,98,18,241,1,209,32,113,12,98,36,96,0,144,192,19,184,240,0,17,190,209,33,80,80,19,178,242,1,209,33,241,1,114,2,112,1,19,158,0,238,0,224,0,255,106,0,107,0,108,0,240,0,16,231,242,101,240,0,16,234,128,14,128,14,128,14,240,30,84,83,116,6,110,224,138,226,138,68,133,94,133,94,133,94,133,94,133,94,110,63,138,226,138,84,240,0,17,10,129,30,129,30,129,30,241,30,84,83,110,224,139,226,139,68,133,94,133,94,133,94,133,94,133,94,110,63,139,226,139,84,240,0,17,50,130,46,130,46,130,46,242,30,84,67,110,224,140,226,140,68,40,184,42,236,97,2,98,30,77,100,24,150,41,98,96,6,224,158,20,54,61,101,20,68,41,98,24,150,103,0,242,1,240,0,15,89,97,1,98,16,209,47,240,0,15,232,97,1,98,32,209,40,43,242,42,224,55,2,20,92,96,0,101,254,243,1,110,2,98,30,131,0,43,242,129,224,98,30,128,48,133,4,48,255,112,5,79,1,41,42,42,224,49,38,20,110,36,150,79,2,37,48,63,2,37,144,40,146,0,238,110,0,97,38,98,30,96,1,128,226,243,1,113,253,114,255,64,0,240,0,16,119,64,1,240,0,16,149,209,47,113,253,195,3,242,1,67,0,240,0,16,179,67,1,240,0,16,184,67,2,240,0,16,189,67,3,240,0,16,194,209,37,113,6,114,1,41,98,0,252,98,30,41,98,113,253,114,255,64,0,240,0,16,149,64,1,240,0,16,119,209,47,105,0,43,150,42,224,126,1,111,0,78,20,37,18,78,40,37,28,78,60,37,38,79,2,0,238,62,64,20,152,0,238,77,102,26,110,77,200,111,2,0,238,77,103,26,110,77,201,111,2,0,238,77,104,26,110,77,202,111,2,0,238,101,10,97,38,98,30,41,98,0,252,41,98,105,0,43,150,143,80,255,21,255,7,63,0,21,68,117,2,126,1,53,40,21,50,97,38,98,30,41,98,0,251,41,98,105,123,43,150,143,80,255,21,255,7,63,0,21,100,53,10,117,253,126,255,62,0,21,82,97,38,98,30,41,98,97,40,98,24,41,252,240,0,16,205,81,19,113,1,81,18,40,240,111,2,0,238,110,0,40,240,97,38,98,30,41,98,0,252,41,98,37,176,42,224,96,6,224,161,21,204,126,1,224,158,21,148,0,238,240,0,22,38,254,30,240,101,64,255,110,0,48,255,189,44,0,238,241,1,97,124,98,24,209,32,0,238,97,38,98,30,41,98,240,0,22,134,254,30,84,67,128,64,128,14,181,226,0,238,22,138,21,234,22,4,22,30,111,3,143,215,63,0,101,2,111,3,143,215,79,0,101,1,111,2,143,215,79,0,101,0,22,56,111,5,143,215,63,0,101,2,111,5,143,215,79,0,101,1,111,4,143,215,79,0,101,0,22,56,111,7,143,215,63,0,101,2,111,7,143,215,79,0,101,1,111,6,143,215,79,0,101,0,22,56,110,0,97,38,98,30,41,98,113,253,114,255,243,1,240,0,16,119,209,47,96,1,128,226,97,38,98,30,41,98,113,253,114,255,243,1,64,0,240,0,16,119,64,1,240,0,16,149,209,47,0,252,64,0,240,0,16,149,64,1,240,0,16,119,209,47,97,38,98,30,41,98,42,224,126,1,62,32,22,76,22,140,0,238,110,0,97,124,98,24,68,1,240,0,23,5,68,2,240,0,23,133,68,3,240,0,24,5,241,1,209,32,42,224,97,38,98,30,41,98,97,124,98,24,243,1,0,252,68,1,240,0,23,37,68,2,240,0,23,165,68,3,240,0,24,37,241,1,209,32,97,38,98,30,41,98,42,224,97,38,98,30,41,98,97,124,98,24,243,1,0,252,68,1,240,0,23,69,68,2,240,0,23,197,68,3,240,0,24,69,241,1,209,32,97,38,98,30,41,98,42,224,97,38,98,30,41,98,97,124,98,24,243,1,0,252,68,1,240,0,23,101,68,2,240,0,23,229,68,3,240,0,24,101,241,1,209,32,97,38,98,30,41,98,42,224,97,38,98,30,41,98,0,252,41,98,42,224,126,1,62,16,23,46,69,0,23,72,53,0,23,132,110,0,97,48,98,24,68,1,240,0,23,5,68,2,240,0,23,133,68,3,240,0,24,5,241,1,209,32,243,1,0,251,241,1,209,32,42,224,126,1,62,24,23,78,240,10,240,0,16,205,81,19,113,1,81,18,40,246,18,0,41,98,42,224,42,224,0,224,110,127,129,224,98,30,41,98,42,224,129,224,41,98,126,252,129,224,41,98,42,224,62,63,23,150,69,2,23,208,53,2,23,174,241,1,40,160,110,63,129,224,98,30,41,98,126,252,129,224,41,98,42,224,62,3,23,184,41,98,97,1,98,24,41,252,0,238,241,1,40,160,110,63,129,224,98,30,96,0,113,253,114,255,41,216,129,224,98,30,41,98,113,253,114,255,41,216,126,252,111,1,128,243,129,224,114,1,41,98,113,253,114,255,41,216,42,224,62,3,23,226,41,216,113,3,114,1,41,98,97,1,41,98,240,10,68,1,24,32,68,2,24,46,24,60,0,238,240,0,16,205,81,19,113,1,81,18,40,252,18,0,240,0,16,205,81,19,113,1,81,18,41,2,18,0,243,1,110,0,0,252,42,224,126,1,62,6,24,64,97,124,98,24,240,0,25,19,209,32,42,224,0,252,240,0,25,83,209,32,42,224,0,252,240,0,25,147,209,32,42,224,0,252,240,0,25,211,209,32,42,224,0,252,42,224,0,252,42,224,0,252,42,224,0,252,42,224,0,252,42,224,0,252,42,224,240,10,18,0,0,238,240,10,18,0,114,250,113,255,41,252,40,146,0,238,97,0,98,0,96,0,40,178,112,6,114,8,50,64,24,166,0,238,189,116,209,40,0,238,240,0,16,231,83,83,240,0,17,90,96,25,129,48,65,0,24,208,240,30,113,255,24,198,96,5,129,64,65,0,24,222,240,30,113,255,24,212,96,1,129,80,65,0,24,236,240,30,113,255,24,226,93,211,0,238,96,0,41,8,0,238,96,6,41,8,0,238,96,12,41,8,0,238,96,18,41,8,0,238,240,0,16,206,81,19,143,16,143,7,79,0,0,238,129,0,81,18,240,0,16,207,240,30,245,101,240,0,16,199,245,85,0,238,111,4,143,23,79,0,25,86,113,252,114,255,195,3,242,1,67,0,240,0,16,179,67,1,240,0,16,184,67,2,240,0,16,189,67,3,240,0,16,194,209,37,113,4,114,1,41,98,113,1,41,98,142,16,0,238,243,1,111,31,131,160,131,242,240,0,14,32,243,30,209,35,131,160,131,54,131,54,131,54,131,54,131,54,129,52,111,127,143,21,79,0,0,238,111,31,131,176,131,242,240,0,14,32,243,30,209,35,131,176,131,54,131,54,131,54,131,54,131,54,129,52,111,127,143,21,79,0,0,238,111,31,131,192,131,242,240,0,14,32,243,30,209,35,131,176,131,54,131,54,131,54,131,54,131,54,129,53,131,160,131,54,131,54,131,54,131,54,131,54,129,53,0,238,243,1,64,0,240,0,16,119,64,1,240,0,16,149,209,47,0,238,243,1,64,0,240,0,16,149,64,1,240,0,16,119,209,47,0,238,242,1,240,0,19,134,209,32,42,224,209,32,240,0,19,166,209,32,42,224,209,32,240,0,19,198,209,32,42,224,209,32,240,0,19,230,209,32,42,224,209,32,240,0,20,6,209,32,42,224,209,32,240,0,20,38,209,32,42,224,209,32,240,0,20,70,209,32,42,224,209,32,240,0,20,102,209,32,42,224,209,32,240,0,20,134,209,32,42,224,209,32,240,0,20,166,209,32,42,224,209,32,240,0,20,198,209,32,42,224,209,32,0,238,97,38,98,30,41,98,242,1,114,249,240,0,20,230,209,32,42,224,113,4,240,0,21,6,209,32,42,224,113,4,240,0,21,38,209,32,42,224,113,4,240,0,21,70,209,32,42,224,113,4,240,0,21,102,209,32,42,224,113,4,240,0,21,134,209,32,42,224,113,4,240,0,21,166,209,32,42,224,113,4,240,0,21,198,209,32,42,224,113,4,240,0,21,230,209,32,42,224,113,4,240,0,22,6,209,32,42,224,113,4,40,146,0,238,111,10,255,21,255,7,63,0,26,228,0,238,241,1,240,0,13,179,96,0,97,0,208,31,240,0,13,164,97,15,208,31,240,0,13,194,97,30,208,31,240,0,13,179,97,45,208,31,240,0,13,164,97,60,208,31,240,0,24,165,94,227,97,8,98,0,240,0,14,223,209,47,114,15,78,0,43,118,50,75,27,38,113,8,98,0,49,128,27,38,78,1,43,64,0,238,97,80,98,8,240,0,24,166,209,32,114,15,240,0,24,198,209,32,113,250,98,8,240,0,24,230,209,47,114,15,240,0,24,245,209,47,114,15,240,0,25,4,209,47,110,0,240,0,24,165,94,226,0,238,111,64,143,21,63,0,27,148,192,7,48,0,27,148,240,0,15,74,242,1,209,47,241,1,209,47,240,0,14,223,0,238,57,123,240,0,14,62,73,123,240,0,14,127,254,30,240,101,187,194,0,238,0,238,57,123,97,124,73,123,97,0,98,0,241,1,209,47,114,15,50,75,27,184,0,238,27,212,27,218,27,218,27,224,27,224,27,230,27,230,27,236,0,238,240,0,14,238,27,172,240,0,14,253,27,172,240,0,15,12,27,172,240,0,15,27,27,172,240,0,15,42,27,172,71,19,0,238,97,254,44,10,97,255,44,10,119,1,97,254,44,10,97,255,44,10,0,238,128,112,128,14,188,18,0,238,28,60,28,60,28,74,28,74,28,88,28,88,28,102,28,102,28,116,28,116,28,130,28,130,28,144,28,144,28,158,28,158,28,172,28,172,28,186,28,186,0,238,65,254,240,0,15,89,65,255,240,0,15,232,28,200,65,254,240,0,15,104,65,255,240,0,15,247,28,200,65,254,240,0,15,119,65,255,240,0,16,6,28,200,65,254,240,0,15,134,65,255,240,0,16,21,28,200,65,254,240,0,15,148,65,255,240,0,16,35,28,200,65,254,240,0,15,162,65,255,240,0,16,49,28,200,65,254,240,0,15,176,65,255,240,0,16,63,28,200,65,254,240,0,15,190,65,255,240,0,16,77,28,200,65,254,240,0,15,204,65,255,240,0,16,91,28,200,65,254,240,0,15,218,65,255,240,0,16,105,28,200,242,1,65,254,98,16,65,255,98,32,97,1,209,47,0,238,240,0,17,198,19,60,240,0,17,230,19,60,240,0,18,6,19,60,240,0,18,38,19,60,240,0,18,70,19,102,240,0,18,102,19,102,240,0,18,134,19,102,240,0,18,166,19,102,240,0,18,198,19,102,240,0,18,230,19,144,240,0,19,6,19,144,240,0,19,38,19,144,240,0,19,70,19,144,240,0,19,102,19,144,240,0,22,229,21,194,240,0,23,5,21,194,240,0,23,37,21,194,240,0,23,69,21,194,240,0,23,101,21,194,240,0,23,133,21,194,240,0,23,165,21,194,240,0,23,197,21,194,240,0,24,5,21,194,240,0,24,37,21,194,240,0,24,69,21,194,240,0,24,101,21,194,240,0,13,224,24,180,240,0,13,232,24,180,240,0,13,240,24,180,240,0,13,248,24,180,240,0,14,0,24,180,240,0,14,8,24,180,240,0,14,16,24,180,240,0,14,24,24,180,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,87,15,111,127,127,127,127,127,127,127,79,7,79,127,63,63,57,1,127,63,63,63,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,63,63,128,224,240,224,192,192,128,128,128,192,160,160,144,208,200,132,252,248,240,224,192,224,224,192,224,240,224,192,128,128,128,128,128,128,128,192,160,192,160,144,152,248,176,160,224,224,192,128,192,224,224,192,224,176,152,136,200,240,224,192,224,224,192,128,0,0,0,0,0,0,0,192,0,0,192,0,0,240,0,0,240,0,192,192,192,192,192,192,240,240,240,240,240,240,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,112,240,112,240,176,240,176,240,208,240,208,240,240,224,240,112,208,112,208,176,224,176,224,208,112,208,112,224,176,224,16,32,16,32,16,128,16,128,64,128,64,128,64,32,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,0,238,128,192,160,144,136,136,136,144,152,164,194,130,132,152,224,0,0,0,0,0,0,0,0,0,0,0,192,224,192,128,0,0,0,0,0,0,0,0,48,104,200,144,160,192,128,0,0,0,0,0,0,0,56,108,210,173,82,204,128,128,0,0,0,0,48,88,168,252,236,216,168,80,224,128,0,80,228,112,176,88,176,244,96,232,160,80,128,192,0,72,128,40,130,88,32,116,96,248,172,116,188,192,128,36,8,1,136,66,56,76,214,162,250,206,128,192,164,17,64,128,208,114,184,84,244,176,80,224,128,64,162,16,72,128,201,96,129,66,192,168,0,144,128,64,40,144,68,32,2,160,16,0,128,64,0,160,0,64,128,192,224,192,0,0,0,0,0,0,0,0,0,0,0,128,192,160,144,200,104,48,0,0,0,0,0,0,0,0,128,128,204,82,173,210,108,56,0,0,0,0,0,0,0,128,224,80,168,216,236,252,168,88,48,0,0,0,0,192,128,80,160,232,96,244,176,88,176,112,228,80,0,192,188,116,172,248,96,116,32,88,130,40,128,72,0,192,128,206,250,162,214,76,56,66,136,1,8,36,128,64,128,224,80,176,244,84,184,114,208,128,64,17,164,64,128,144,0,168,192,66,129,96,201,128,72,16,162,64,0,160,0,64,128,0,16,160,2,32,68,144,40,0,32,192,32,0,0,0,0,0,0,0,0,0,0,0,0,32,192,32,0,0,0,0,0,0,0,0,0,0,0,32,64,128,64,32,0,0,0,0,0,0,0,0,0,0,32,64,128,64,32,0,0,0,0,0,0,0,0,0,0,64,176,96,144,64,64,144,96,176,64,96,176,128,16,128,32,48,128,48,160,4,3,5,3,5,2,0,6,4,2,5,2,5,0,4,3,5,3,5,2,4,4,5,4,5,4,4,4,5,5,5,5,0,0,0,0,2,10,0,0,0,0,0,6,4,20,1,0,0,0,0,12,2,30,2,0,0,0,0,18,4,40,3,0,0,0,0,0,0,0,0,0,0,0,0,6,2,10,1,0,0,0,0,12,4,20,2,0,0,0,0,18,2,30,3,0,0,0,0,24,4,40,4,0,0,0,0,0,0,0,0,0,0,0,0,6,2,10,1,0,0,0,0,12,4,20,2,0,0,0,0,18,2,30,3,0,0,0,0,24,4,40,4,0,0,0,0,200,100,100,100,100,202,2,3,3,102,2,2,103,102,101,2,3,104,4,102,102,101,101,101,101,201,100,100,100,100,1,2,3,103,102,2,3,5,4,102,4,103,104,4,101,102,101,101,101,101,201,100,100,100,100,1,2,104,103,102,2,104,103,102,101,1,2,3,4,5,2,3,103,4,6,4,100,100,100,100,2,3,103,4,102,3,4,3,103,101,4,104,5,4,6,5,6,103,6,7,128,24,24,153,219,126,60,24,0,0,0,0,127,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,0,129,0,255,0,129,0,129,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,128,1,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,0,129,0,255,0,129,0,129,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,128,1,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,0,129,0,255,0,129,0,129,0,129,0,255,0,129,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,128,1,255,255,128,1,128,1,128,1,255,255,128,1,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,32,0,32,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,96,0,16,0,136,0,136,0,16,0,96,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,0,24,0,4,0,130,0,194,0,66,0,130,0,4,0,24,0,224,0,0,0,0,0,0,0,0,0,0,0,240,0,14,0,1,0,72,128,224,128,160,64,96,64,208,128,64,128,129,0,14,0,240,0,0,0,0,0,0,0,248,0,7,0,130,192,132,32,80,16,240,8,248,8,172,8,216,8,92,16,162,32,0,192,7,0,248,0,0,0,12,32,3,192,128,48,192,12,116,2,88,130,244,2,126,1,175,1,219,2,95,18,182,2,252,12,176,48,67,192,12,0,0,248,0,6,128,1,195,224,166,24,244,136,221,232,253,216,239,56,251,104,95,208,167,112,193,192,128,1,0,6,0,248,192,0,160,0,224,112,64,236,160,30,162,138,83,234,125,218,143,58,251,106,83,210,160,114,192,254,64,56,96,0,192,0,0,0,32,120,224,92,0,70,32,30,160,2,80,14,108,2,132,3,216,11,80,83,160,14,64,150,128,248,192,32,64,0,128,88,0,80,192,12,0,8,128,28,160,2,144,12,64,2,0,1,128,8,192,16,128,8,64,18,0,8,64,40,0,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,128,0,160,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,16,0,64,0,196,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,4,0,0,0,112,0,224,0,188,128,104,0,16,0,0,0,4,0,0,0,0,0,0,0,0,0,8,0,1,0,0,0,56,0,105,0,116,0,220,0,254,0,118,16,94,0,60,0,0,0,0,0,0,0,2,0,0,64,4,0,0,0,6,0,59,16,121,128,116,192,95,96,255,32,214,64,238,192,115,128,61,132,31,0,0,0,0,128,0,0,0,4,7,0,3,192,131,64,193,224,244,240,95,240,251,160,102,192,254,192,109,160,191,160,199,96,1,193,0,0,0,0,0,0,0,0,0,192,0,64,1,238,4,222,15,199,59,251,102,243,62,222,45,160,31,160,7,96,1,192,0,0,0,0,0,0,0,16,0,128,4,0,33,0,4,218,15,64,59,248,103,241,62,216,23,160,19,128,30,0,13,64,0,0,0,0,0,64,0,0,4,0,0,0,33,0,4,74,9,64,24,16,68,129,2,72,16,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,12,18,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,36,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,54,60,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,192,14,240,31,88,29,248,56,252,49,100,59,196,63,164,22,8,28,152,14,112,3,192,0,0,0,0,0,0,0,0,60,0,239,0,245,129,223,129,143,195,22,67,188,67,250,67,96,129,201,129,231,0,60,0,0,0,0,0,0,0,0,0,192,3,240,14,88,31,248,29,252,56,100,49,196,59,164,63,8,22,152,28,112,14,192,3,0,0,0,0,0,0,0,0,0,60,0,239,129,245,129,223,195,143,67,22,67,188,67,250,129,96,129,201,0,231,0,60,0,0,0,0,0,0,0,0,0,0,0,0,3,192,7,224,15,176,15,80,11,240,13,240,7,224,3,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,126,0,251,0,245,0,191,0,223,0,126,0,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,3,224,7,176,15,80,15,240,11,240,13,224,7,192,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,28,0,13,192,5,224,11,240,11,240,13,240,14,240,7,96,3,176,0,56,0,24,0,0,0,0,0,0,0,0,128,1,192,1,220,0,94,0,191,0,191,0,223,0,239,0,118,0,59,0,3,128,1,128,0,0,0,0,0,0,0,0,0,24,0,28,192,13,224,5,240,11,240,11,240,13,240,14,96,7,176,3,56,0,24,0,0,0,0,0,0,0,0,0,1,128,1,192,0,220,0,94,0,191,0,191,0,223,0,239,0,118,0,59,128,3,128,1,0,0,0,0,0,0,0,0,3,192,15,240,31,248,31,248,63,252,63,252,63,252,63,252,31,248,31,248,15,240,3,192,0,0,0,0,1,9,30,18,161,20,161,9,30,0,0,31,30,4,161,4,161,3,18,0,0,31,1,2,191,2,129,31,1,0,0,0,0,15,30,16,161,16,161,9,30,0,0,15,0,18,128,18,128,16,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,9,9,6,0,62,9,25,38,0,30,33,33,30,0,30,33,41,26,0,62,9,25,38,0,62,5,5,62,0,62,1,6,1,1,62,0,0,0,0,0,0,0,0,0,0,0,3,252,254,62,252,31,228,31,132,31,134,63,135,255,135,255,135,254,135,142,151,4,255,0,255,0,0,0,0,0,0,0,0,0,1,192,2,224,27,224,75,224,73,192,72,0,72,0,72,0,72,112,104,248,0,248,0,216,0,240,0,0,0,0,63,192,227,239,193,255,65,254,65,248,99,248,127,248,127,248,127,232,120,232,112,73,240,15,240,15,0,0,0,0,0,0,0,0,28,0,46,0,190,1,190,4,156,4,128,4,128,4,128,4,135,4,143,134,15,128,13,128,15,0,0,0,0,0,252,3,62,254,31,252,31,228,31,132,63,134,255,135,255,135,254,135,142,135,4,151,0,255,0,255,0,0,0,0,0,0,0,0,192,1,224,2,224,27,224,75,192,73,0,72,0,72,0,72,112,72,248,104,248,0,216,0,240,0,0,0,0,0,192,63,239,227,255,193,254,65,248,65,248,99,248,127,248,127,232,127,232,120,73,112,15,240,15,240,0,0,0,0,0,0,0,0,0,28,0,46,1,190,4,190,4,156,4,128,4,128,4,128,4,135,134,143,128,15,128,13,0,15,0,0]}</script>
<script>"use strict";

function invertKeymap(k) {
	return Object.keys(k).reduce((a,b) => {
		Object.keys(k[b]).forEach(x => a[x]=+b)
		return a
	}, {})
}

function getPref(key) {
	try { return JSON.parse(localStorage.getItem(key)) }
	catch(e) { console.log(e); return null }
}
function setPref(key, value) {
	try { localStorage.setItem(key, JSON.stringify(value)) }
	catch(e) { console.log(e); }
}

var keymap = (this.STATIC_KEYMAP) || getPref('octoKeymap') || {
	0x0: { x:1 },
	0x1: { 1:1 },
	0x2: { 2:1 },
	0x3: { 3:1 },
	0x4: { q:1 },
	0x5: { w:1, ArrowUp:1 },
	0x6: { e:1, ' ':1 },
	0x7: { a:1, ArrowLeft:1 },
	0x8: { s:1, ArrowDown:1 },
	0x9: { d:1, ArrowRight:1 },
	0xA: { z:1 },
	0xB: { c:1 },
	0xC: { 4:1 },
	0xD: { r:1 },
	0xE: { f:1 },
	0xF: { v:1 },
}

var keymapInverse = invertKeymap(keymap)

var smallfonts = {
	octo: [
		0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
		0x20, 0x60, 0x20, 0x20, 0x70, // 1
		0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
		0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
		0x90, 0x90, 0xF0, 0x10, 0x10, // 4
		0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
		0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
		0xF0, 0x10, 0x20, 0x40, 0x40, // 7
		0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
		0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
		0xF0, 0x90, 0xF0, 0x90, 0x90, // A
		0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
		0xF0, 0x80, 0x80, 0x80, 0xF0, // C
		0xE0, 0x90, 0x90, 0x90, 0xE0, // D
		0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
		0xF0, 0x80, 0xF0, 0x80, 0x80, // F
	],
	vip: [
		0xF0, 0x90, 0x90, 0x90, 0xF0,
		0x60, 0x20, 0x20, 0x20, 0x70,
		0xF0, 0x10, 0xF0, 0x80, 0xF0,
		0xF0, 0x10, 0xF0, 0x10, 0xF0,
		0xA0, 0xA0, 0xF0, 0x20, 0x20,
		0xF0, 0x80, 0xF0, 0x10, 0xF0,
		0xF0, 0x80, 0xF0, 0x90, 0xF0,
		0xF0, 0x10, 0x10, 0x10, 0x10,
		0xF0, 0x90, 0xF0, 0x90, 0xF0,
		0xF0, 0x90, 0xF0, 0x10, 0xF0,
		0xF0, 0x90, 0xF0, 0x90, 0x90,
		0xF0, 0x50, 0x70, 0x50, 0xF0,
		0xF0, 0x80, 0x80, 0x80, 0xF0,
		0xF0, 0x50, 0x50, 0x50, 0xF0,
		0xF0, 0x80, 0xF0, 0x80, 0xF0,
		0xF0, 0x80, 0xF0, 0x80, 0x80,
	],
	dream6800: [
		0xE0, 0xA0, 0xA0, 0xA0, 0xE0,
		0x40, 0x40, 0x40, 0x40, 0x40,
		0xE0, 0x20, 0xE0, 0x80, 0xE0,
		0xE0, 0x20, 0xE0, 0x20, 0xE0,
		0x80, 0xA0, 0xA0, 0xE0, 0x20,
		0xE0, 0x80, 0xE0, 0x20, 0xE0,
		0xE0, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0xA0, 0xE0, 0xA0, 0xE0,
		0xE0, 0xA0, 0xE0, 0x20, 0xE0,
		0xE0, 0xA0, 0xE0, 0xA0, 0xA0,
		0xC0, 0xA0, 0xE0, 0xA0, 0xC0,
		0xE0, 0x80, 0x80, 0x80, 0xE0,
		0xC0, 0xA0, 0xA0, 0xA0, 0xC0,
		0xE0, 0x80, 0xE0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
	eti660: [
		0xE0, 0xA0, 0xA0, 0xA0, 0xE0,
		0x20, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0x20, 0xE0, 0x80, 0xE0,
		0xE0, 0x20, 0xE0, 0x20, 0xE0,
		0xA0, 0xA0, 0xE0, 0x20, 0x20,
		0xE0, 0x80, 0xE0, 0x20, 0xE0,
		0xE0, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0xA0, 0xE0, 0xA0, 0xE0,
		0xE0, 0xA0, 0xE0, 0x20, 0xE0,
		0xE0, 0xA0, 0xE0, 0xA0, 0xA0,
		0x80, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x80, 0x80, 0x80, 0xE0,
		0x20, 0x20, 0xE0, 0xA0, 0xE0,
		0xE0, 0x80, 0xE0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
	fish: [
		0x60, 0xA0, 0xA0, 0xA0, 0xC0,
		0x40, 0xC0, 0x40, 0x40, 0xE0,
		0xC0, 0x20, 0x40, 0x80, 0xE0,
		0xC0, 0x20, 0x40, 0x20, 0xC0,
		0x20, 0xA0, 0xE0, 0x20, 0x20,
		0xE0, 0x80, 0xC0, 0x20, 0xC0,
		0x40, 0x80, 0xC0, 0xA0, 0x40,
		0xE0, 0x20, 0x60, 0x40, 0x40,
		0x40, 0xA0, 0x40, 0xA0, 0x40,
		0x40, 0xA0, 0x60, 0x20, 0x40,
		0x40, 0xA0, 0xE0, 0xA0, 0xA0,
		0xC0, 0xA0, 0xC0, 0xA0, 0xC0,
		0x60, 0x80, 0x80, 0x80, 0x60,
		0xC0, 0xA0, 0xA0, 0xA0, 0xC0,
		0xE0, 0x80, 0xC0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
}
var bigfonts = {
	octo: [
		0xFF, 0xFF, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, // 0
		0x18, 0x78, 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, // 1
		0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, // 2
		0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 3
		0xC3, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, // 4
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 5
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, // 6
		0xFF, 0xFF, 0x03, 0x03, 0x06, 0x0C, 0x18, 0x18, 0x18, 0x18, // 7
		0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, // 8
		0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 9
		0x7E, 0xFF, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, 0xC3, 0xC3, 0xC3, // A
		0xFC, 0xFC, 0xC3, 0xC3, 0xFC, 0xFC, 0xC3, 0xC3, 0xFC, 0xFC, // B
		0x3C, 0xFF, 0xC3, 0xC0, 0xC0, 0xC0, 0xC0, 0xC3, 0xFF, 0x3C, // C
		0xFC, 0xFE, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xFE, 0xFC, // D
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, // E
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC0, 0xC0, 0xC0, 0xC0  // F
	],
	schip: [
		0x3C, 0x7E, 0xE7, 0xC3, 0xC3, 0xC3, 0xC3, 0xE7, 0x7E, 0x3C,
		0x18, 0x38, 0x58, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C,
		0x3E, 0x7F, 0xC3, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xFF, 0xFF,
		0x3C, 0x7E, 0xC3, 0x03, 0x0E, 0x0E, 0x03, 0xC3, 0x7E, 0x3C,
		0x06, 0x0E, 0x1E, 0x36, 0x66, 0xC6, 0xFF, 0xFF, 0x06, 0x06,
		0xFF, 0xFF, 0xC0, 0xC0, 0xFC, 0xFE, 0x03, 0xC3, 0x7E, 0x3C,
		0x3E, 0x7C, 0xE0, 0xC0, 0xFC, 0xFE, 0xC3, 0xC3, 0x7E, 0x3C,
		0xFF, 0xFF, 0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x60, 0x60,
		0x3C, 0x7E, 0xC3, 0xC3, 0x7E, 0x7E, 0xC3, 0xC3, 0x7E, 0x3C,
		0x3C, 0x7E, 0xC3, 0xC3, 0x7F, 0x3F, 0x03, 0x03, 0x3E, 0x7C,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // no hex chars!
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	],
	fish: [
		0x7C, 0xC6, 0xCE, 0xDE, 0xD6, 0xF6, 0xE6, 0xC6, 0x7C, 0x00, // at most 7x9 pixels!
		0x10, 0x30, 0xF0, 0x30, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00,
		0x78, 0xCC, 0xCC, 0x0C, 0x18, 0x30, 0x60, 0xCC, 0xFC, 0x00,
		0x78, 0xCC, 0x0C, 0x0C, 0x38, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
		0x0C, 0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x0C, 0x1E, 0x00,
		0xFC, 0xC0, 0xC0, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
		0x38, 0x60, 0xC0, 0xC0, 0xF8, 0xCC, 0xCC, 0xCC, 0x78, 0x00,
		0xFE, 0xC6, 0xC6, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00,
		0x78, 0xCC, 0xCC, 0xEC, 0x78, 0xDC, 0xCC, 0xCC, 0x78, 0x00,
		0x7C, 0xC6, 0xC6, 0xC6, 0x7C, 0x18, 0x18, 0x30, 0x70, 0x00,
		0x30, 0x78, 0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, 0x00,
		0xFC, 0x66, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x66, 0xFC, 0x00,
		0x3C, 0x66, 0xC6, 0xC0, 0xC0, 0xC0, 0xC6, 0x66, 0x3C, 0x00,
		0xF8, 0x6C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x6C, 0xF8, 0x00,
		0xFE, 0x62, 0x60, 0x64, 0x7C, 0x64, 0x60, 0x62, 0xFE, 0x00,
		0xFE, 0x66, 0x62, 0x64, 0x7C, 0x64, 0x60, 0x60, 0xF0, 0x00,
	],
	none: new Array(16*10).fill(0x00),
}
var fontsets = {
	octo     : { small: smallfonts.octo,      big: bigfonts.octo  },
	vip      : { small: smallfonts.vip,       big: bigfonts.none  },
	dream6800: { small: smallfonts.dream6800, big: bigfonts.none  },
	eti660   : { small: smallfonts.eti660,    big: bigfonts.none  },
	schip    : { small: smallfonts.octo,      big: bigfonts.schip },
	fish     : { small: smallfonts.fish,      big: bigfonts.fish  },
}

////////////////////////////////////
//
//   The Chip8 Interpreter:
//
////////////////////////////////////

function Emulator() {

	// persistent configuration settings
	this.tickrate           = 20;
	this.fillColor          = "#FFCC00";
	this.fillColor2         = "#FF6600";
	this.blendColor         = "#662200";
	this.backgroundColor    = "#996600";
	this.buzzColor          = "#FFAA00";
	this.quietColor         = "#000000";
	this.shiftQuirks        = false;
	this.loadStoreQuirks    = false;
	this.vfOrderQuirks      = false;
	this.clipQuirks         = false;
	this.jumpQuirks         = false;
	this.logicQuirks        = false;
	this.vBlankQuirks       = false;
	this.enableXO           = true;
	this.screenRotation     = 0;//must be 0, 90, 180, or 270
	this.maxSize            = 3584;
	this.touchInputMode     = 'none';
	this.maskFormatOverride = true;
	this.numericFormatStr   = "default";
	this.fontStyle          = 'octo';

	// interpreter state
	this.p  = [[],[]];  // pixels
	this.m  = [];       // memory (bytes)
	this.r  = [];       // return stack
	this.v  = [];       // registers
	this.pc = 0;        // program counter
	this.i  = 0;        // index register
	this.dt = 0;        // delay timer
	this.st = 0;        // sound timer
	this.hires = false; // are we in SuperChip high res mode?
	this.flags = [];    // semi-persistent hp48 flag vars
	this.pattern = [];  // audio pattern buffer
	this.plane = 1;     // graphics plane
	this.profile_data = {};

	// control/debug state
	this.keys = {};       // track keys which are pressed
	this.waiting = false; // are we waiting for a keypress?
	this.waitReg = -1;    // destination register of an awaited key
	this.halted = true;
	this.breakpoint = false;
	this.metadata = {};
	this.tickCounter = 0;
	this.linted = false;

	// external interface stubs
	this.exitVector  = function() {}                                   // fired by 'exit'
	this.importFlags = function() { return [0, 0, 0, 0, 0, 0, 0, 0]; } // load persistent flags
	this.exportFlags = function(flags) {}                              // save persistent flags
	this.buzzTrigger = function(ticks, remainingTicks) {}                              // fired when buzzer played

	this.init = function(rom) {
		// initialise memory with a new array to ensure that it is of the right size and is initiliased to 0
		this.m = this.enableXO ? new Uint8Array(0x10000) : new Uint8Array(0x1000);

		this.p = [[], []];
		if (this.enableXO)
			for(var z = 0; z < 64*128; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
		else
			for(var z = 0; z < 32*64; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }

		// initialize memory
		var font = fontsets[this.fontStyle];
		for(var z = 0; z < 32*64;            z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
		for(var z = 0; z < font.small.length;z++) { this.m[z] = font.small[z]; }
		for(var z = 0; z < font.big.length;  z++) { this.m[z + font.small.length] = font.big[z]; }
		for(var z = 0; z < rom.rom.length;   z++) { this.m[0x200+z] = rom.rom[z]; }
		for(var z = 0; z < 16;               z++) { this.v[z] = 0; }
		for(var z = 0; z < 16;               z++) { this.pattern[z] = 0; }

		// initialize interpreter state
		this.r = [];
		this.pc = 0x200;
		this.i  = 0;
		this.dt = 0;
		this.st = 0;
		this.hires = false;
		this.plane = 1;

		// initialize control/debug state
		this.keys = {};
		this.waiting = false;
		this.waitReg = -1;
		this.halted = false;
		this.breakpoint = false;
		this.stack_breakpoint = -1;
		this.metadata = rom;
		this.tickCounter = 0;
		this.profile_data = {};
	}

	this.writeCarry = function(dest, value, flag) {
		this.v[dest] = (value & 0xFF);
		this.v[0xF] = flag ? 1 : 0;
		if (this.vfOrderQuirks) {
			this.v[dest] = (value & 0xFF);
		}
	}

	this.math = function(x, y, op) {
		// basic arithmetic opcodes
		switch(op) {
			case 0x0: this.v[x]  = this.v[y]; break;
			case 0x1: this.v[x] |= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x2: this.v[x] &= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x3: this.v[x] ^= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x4:
				var t = this.v[x]+this.v[y];
				this.writeCarry(x, t, (t > 0xFF));
				break;
			case 0x5:
				var t = this.v[x]-this.v[y];
				this.writeCarry(x, t, (this.v[x] >= this.v[y]));
				break;
			case 0x7:
				var t = this.v[y]-this.v[x];
				this.writeCarry(x, t, (this.v[y] >= this.v[x]));
				break;
			case 0x6:
				if (this.shiftQuirks) { y = x; }
				var t = this.v[y] >> 1;
				this.writeCarry(x, t, (this.v[y] & 0x1));
				break;
			case 0xE:
				if (this.shiftQuirks) { y = x; }
				var t = this.v[y] << 1;
				this.writeCarry(x, t, ((this.v[y] >> 7) & 0x1));
				break;
			default:
				haltBreakpoint("unknown math opcode "+op.toString(16).toUppercase());
		}
	}

	this.misc = function(x, rest) {
		// miscellaneous opcodes
		switch(rest) {
			case 0x01:
				this.plane = (x & 0x3);
				break;
			case 0x02:
				for(var z = 0; z < 16; z++) {
					this.pattern[z] = this.m[this.i+z];
				}
				break;
			case 0x07: this.v[x] = this.dt; break;
			case 0x0A: this.waiting = true; this.waitReg = x; break;
			case 0x15: this.dt = this.v[x]; break;
			case 0x18: this.buzzTrigger(this.v[x], this.st); this.st = this.v[x]; break;
			case 0x1E: this.i = (this.i + this.v[x])&0xFFFF; break;
			case 0x29: this.i = ((this.v[x] & 0xF) * 5); break;
			case 0x30: this.i = ((this.v[x] & 0xF) * 10 + fontsets[this.fontStyle].small.length); break;
			case 0x33:
				this.m[this.i]   = Math.floor(this.v[x]/100)%10;
				this.m[this.i+1] = Math.floor(this.v[x]/10)%10;
				this.m[this.i+2] = this.v[x]%10;
				break;
			case 0x55:
				for(var z = 0; z <= x; z++) { this.m[this.i+z] = this.v[z]; }
				if (!this.loadStoreQuirks) { this.i = (this.i+x+1)&0xFFFF; }
				break;
			case 0x65:
				for(var z = 0; z <= x; z++) { this.v[z] = this.m[this.i+z]; }
				if (!this.loadStoreQuirks) { this.i = (this.i+x+1)&0xFFFF; }
				break;
			case 0x75:
				for(var z = 0; z <= x; z++) { this.flags[z] = this.v[z]; }
				this.exportFlags(this.flags);
				break;
			case 0x85:
				this.flags = this.importFlags();
				if (typeof this.flags == "undefined" || this.flags == null) {
					this.flags = [0, 0, 0, 0, 0, 0, 0, 0];
				}
				for(var z = 0; z <= x; z++) { this.v[z] = this.flags[z]; }
				break;
			default:
				haltBreakpoint("unknown misc opcode "+rest.toString(16).toUppercase());
		}
	}

	this.sprite = function sprite(x, y, len) {
		this.v[0xF] = 0x0;
		var rowSize = this.hires ? 128 : 64;
		var colSize = this.hires ?  64 : 32;
		var i = this.i;
		for(var layer = 0; layer < 2; layer++) {
			if ((this.plane & (layer+1)) == 0) { continue; }
			if (len == 0) {
				// draw a SuperChip 16x16 sprite
				for(var a = 0; a < 16; a++) {
					for(var b = 0; b < 16; b++) {
						var target = ((x+b) % rowSize) + ((y+a) % colSize)*rowSize;
						var source = ((this.m[i+(a*2)+(b > 7 ? 1:0)] >> (7-(b%8))) & 0x1) != 0;
						if (this.clipQuirks) {
							if ((x%rowSize)+b>=rowSize || (y%colSize)+a>=colSize) { source = 0; }
						}
						if (!source) { continue; }
						if (this.p[layer][target]) { this.p[layer][target] = 0; this.v[0xF] = 0x1; }
						else { this.p[layer][target] = 1; }
					}
				}
				i += 32;
			}
			else {
				// draw a Chip8 8xN sprite
				for(var a = 0; a < len; a++) {
					for(var b = 0; b < 8; b++) {
						var target = ((x+b) % rowSize) + ((y+a) % colSize)*rowSize;
						var source = ((this.m[i+a] >> (7-b)) & 0x1) != 0;
						if (this.clipQuirks) {
							if ((x%rowSize)+b>=rowSize || (y%colSize)+a>=colSize) { source = 0; }
						}
						if (!source) { continue; }
						if (this.p[layer][target]) { this.p[layer][target] = 0; this.v[0xF] = 0x1; }
						else { this.p[layer][target] = 1; }
					}
				}
				i += len;
			}
		}
	}

	this.call = function(nnn) {
		if (this.r.length >= 12) {
			haltBreakpoint("call stack overflow.");
		}
		this.r.push(this.pc);
		this.pc = nnn
	}

	this.jump0 = function(nnn) {
		if (this.jumpQuirks) { this.pc = nnn + this.v[(nnn >> 8)&0xF];  }
		else                 { this.pc = nnn + this.v[0]; }
	}

	this.machine = function(nnn) {
		if (nnn == 0x000) { this.halted = true; return; }
		haltBreakpoint("machine code is not supported.");
	}

	this.skip = function() {
		var op = (this.m[this.pc  ] << 8) | this.m[this.pc+1];
		this.pc += (op == 0xF000) ? 4 : 2;
	}

	this.opcode = function() {
		// Increment profilining data
		this.profile_data[this.pc] = (this.profile_data[this.pc] || 0) + 1;

		// decode the current opcode
		var op  = (this.m[this.pc  ] << 8) | this.m[this.pc+1];
		var o   = (this.m[this.pc  ] >> 4) & 0x00F;
		var x   = (this.m[this.pc  ]     ) & 0x00F;
		var y   = (this.m[this.pc+1] >> 4) & 0x00F;
		var n   = (this.m[this.pc+1]     ) & 0x00F;
		var nn  = (this.m[this.pc+1]     ) & 0x0FF;
		var nnn = op & 0xFFF;
		this.pc += 2;

		// execute a simple opcode
		if (op == 0x00E0) {
			// clear
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = 0; z < this.p[layer].length; z++) {
					this.p[layer][z] = 0;
				}
			}
			return;
		}
		if (op == 0x00EE) {
			// return
			this.pc = this.r.pop();
			return;
		}
		if ((op & 0xF0FF) == 0xE09E) {
			// if -key
			if (Object.keys(keymap[this.v[x]]||{}).some(x => x in this.keys)) { this.skip(); }
			return;
		}
		if ((op & 0xF0FF) == 0xE0A1) {
			// if key
			if (!Object.keys(keymap[this.v[x]]||{}).some(x => x in this.keys)) { this.skip(); }
			return;
		}
		if ((op & 0xFFF0) == 0x00C0) {
			// scroll down n pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = this.p[layer].length - 1; z >= 0; z--) {
					this.p[layer][z] = (z >= rowSize * n) ? this.p[layer][z - (rowSize * n)] : 0;
				}
			}
			return;
		}
		if ((op & 0xFFF0) == 0x00D0) {
			// scroll up n pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = 0; z < this.p[layer].length; z++) {
					this.p[layer][z] = (z < (this.p[layer].length - rowSize * n)) ? this.p[layer][z + (rowSize * n)] : 0;
				}
			}
			return;
		}
		if (op == 0x00FB) {
			// scroll right 4 pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var a = 0; a < this.p[layer].length; a += rowSize) {
					for(var b = rowSize-1; b >= 0; b--) {
						this.p[layer][a + b] = (b > 3) ? this.p[layer][a + b - 4] : 0;
					}
				}
			}
			return;
		}
		if (op == 0x00FC) {
			// scroll left 4 pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var a = 0; a < this.p[layer].length; a += rowSize) {
					for(var b = 0; b < rowSize; b++) {
						this.p[layer][a + b] = (b < rowSize - 4) ? this.p[layer][a + b + 4] : 0;
					}
				}
			}
			return;
		}
		if (op == 0x00FD) {
			// exit
			this.halted = true;
			this.exitVector();
			return;
		}
		if (op == 0x00FE) {
			// lores
			this.hires = false;
			this.p = [[], []];
			for(var z = 0; z < 32*64; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
			return;
		}
		if (op == 0x00FF) {
			// hires
			this.hires = true;
			this.p = [[], []];
			for(var z = 0; z < 64*128; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
			return;
		}
		if (op == 0xF000) {
			// long memory reference
			this.i = ((this.m[this.pc] << 8) | (this.m[this.pc+1])) & 0xFFFF;
			this.pc += 2;
			return;
		}

		if (o == 0x5 && n != 0) {
			if (n == 2) {
				// save range
				var dist = Math.abs(x - y);
				if (x < y) { for(var z = 0; z <= dist; z++) { this.m[this.i+z] = this.v[x+z]; }}
				else       { for(var z = 0; z <= dist; z++) { this.m[this.i+z] = this.v[x-z]; }}
				return;
			}
			else if (n == 3) {
				// load range
				var dist = Math.abs(x - y);
				if (x < y) { for(var z = 0; z <= dist; z++) { this.v[x+z] = this.m[this.i+z]; }}
				else       { for(var z = 0; z <= dist; z++) { this.v[x-z] = this.m[this.i+z]; }}
				return;
			}
			else {
				haltBreakpoint("unknown opcode "+op.toString(16).toUppercase());
			}
		}
		if (o == 0x9 && n != 0) {
			haltBreakpoint("unknown opcode "+op.toString(16).toUppercase());
		}

		// dispatch complex opcodes
		switch(o) {
			case 0x0: this.machine(nnn);                            break;
			case 0x1: this.pc = nnn;                                break;
			case 0x2: this.call(nnn);                               break;
			case 0x3: if (this.v[x] == nn)        { this.skip(); }  break;
			case 0x4: if (this.v[x] != nn)        { this.skip(); }  break;
			case 0x5: if (this.v[x] == this.v[y]) { this.skip(); }  break;
			case 0x6: this.v[x] = nn;                               break;
			case 0x7: this.v[x] = (this.v[x] + nn) & 0xFF;          break;
			case 0x8: this.math(x, y, n);                           break;
			case 0x9: if (this.v[x] != this.v[y]) { this.skip(); }  break;
			case 0xA: this.i = nnn;                                 break;
			case 0xB: this.jump0(nnn);                              break;
			case 0xC: this.v[x] = (Math.random()*256)&nn;           break;
			case 0xD: this.sprite(this.v[x], this.v[y], n);         break;
			case 0xF: this.misc(x, nn);                             break;
			default: haltBreakpoint("unknown opcode "+o.toString(16).toUppercase());
		}
	}

	this.tick = function() {
		if (this.halted) { return; }
		this.tickCounter++;
		try {
			this.opcode();
		}
		catch(err) {
			console.log("halted: " + err);
			this.halted = true;
		}
	}
}
</script>
<script>"use strict";

////////////////////////////////////
//
//   Emulator Execution
//
////////////////////////////////////

//must be set > 0
var scaleFactor = 5;
//dom id for canvas element
var renderTarget = "target";

const optionFlags = [
	"tickrate",
	"fillColor",
	"fillColor2",
	"blendColor",
	"backgroundColor",
	"buzzColor",
	"quietColor",
	"shiftQuirks",
	"loadStoreQuirks",
	"vfOrderQuirks",
	"clipQuirks",
	"vBlankQuirks",
	"jumpQuirks",
	"screenRotation",
	"maxSize",
	"touchInputMode",
	"logicQuirks",
	"fontStyle",
]
function unpackOptions(emulator, options) {
	optionFlags.forEach(x => { if (x in options) emulator[x] = options[x] })
	if (options["enableXO"]) emulator.maxSize = 65024 // legacy option
}
function packOptions(emulator) {
	const r = {}
	optionFlags.forEach(x => r[x] = emulator[x])
	return r
}

function setRenderTarget(scale, canvas) {
	scaleFactor = scale;
	renderTarget = canvas;
	var c = document.getElementById(canvas);

	// Remove any existing previous delta frame so first frame is always drawn:
	c.last = undefined;

	var w  = scaleFactor * 128;
	var h  = scaleFactor *  64;

	if (emulator.screenRotation == 90 || emulator.screenRotation == 270) {
		c.width  = h;
		c.height = w;
	}
	else {
		c.width  = w;
		c.height = h;
	}
}

function setTransform(emulator, g) {
	g.setTransform(1, 0, 0, 1, 0, 0);
	var x = scaleFactor * 128;
	var y = scaleFactor *  64;
	switch(emulator.screenRotation) {
		case 90:
			g.rotate(0.5 * Math.PI);
			g.translate(0, -y);
			break;
		case 180:
			g.rotate(1.0 * Math.PI);
			g.translate(-x, -y);
			break;
		case 270:
			g.rotate(1.5 * Math.PI);
			g.translate(-x, 0);
			break;
		default:
			console.assert(emulator.screenRotation === 0, 'Screen rotation not set to 0, 90, 180, or 270. Treating as 0.')
	}
}


function arrayEqual(a, b) {
	var length = a.length;
	if (length !== b.length) { return false; }
	for (var i = 0; i < length; i++) {
		if (a[i] !== b[i]) { return false; }
	}
	return true;
}

function getColor(id) {
	switch(id) {
		case 0: return emulator.backgroundColor;
		case 1: return emulator.fillColor;
		case 2: return emulator.fillColor2;
		case 3: return emulator.blendColor;
	}
	throw "invalid color: " + id;
}

function renderDisplay(emulator) {
	var c = document.getElementById(renderTarget);

	// Canvas rendering can be expensive. Exit out early if nothing has changed.
	var colors = [emulator.backgroundColor, emulator.fillColor, emulator.fillColor2, emulator.blendColor];
	if (c.last !== undefined) {
		if (arrayEqual(c.last.p[0], emulator.p[0]) && arrayEqual(c.last.p[1], emulator.p[1])
				&& arrayEqual(c.last.colors, colors)) {
			return;
		}
		if (c.last.hires !== emulator.hires)
			c.last = undefined;  // full redraw when switching resolution
	}
	var g = c.getContext("2d");
	setTransform(emulator, g);
	var w      = emulator.hires ? 128         : 64;
	var h      = emulator.hires ? 64          : 32;
	var size   = emulator.hires ? scaleFactor : scaleFactor*2;
	var lastPixels = c.last !== undefined? c.last.p: [[], []]

	g.scale(size, size)
	var z = 0;
	for(var y = 0; y < h; ++y) {
		for(var x = 0; x < w; ++x, ++z) {
			var oldColorIdx = lastPixels[0][z] + (lastPixels[1][z] << 1);
			var colorIdx = emulator.p[0][z] + (emulator.p[1][z] << 1);
			if (oldColorIdx !== colorIdx) {
				g.fillStyle = getColor(colorIdx);
				g.fillRect(x, y, 1, 1);
			}
		}
	}
	g.scale(1, 1) //restore scale to 1,1 just in case

	c.last = {
		colors: colors,
		p: [emulator.p[0].slice(), emulator.p[1].slice()],
		hires: emulator.hires,
	};
}

////////////////////////////////////
//
//   Audio Playback
//
////////////////////////////////////

var audio;
var audioNode;
var audioSource;
var audioData;

var AudioBuffer = function(buffer, duration) {
	if (!(this instanceof AudioBuffer)) {
		return new AudioBuffer(buffer, duration);
	}

	this.pointer = 0;
	this.buffer = buffer;
	this.duration = duration;
}

AudioBuffer.prototype.write = function(buffer, index, size) {
	size = Math.max(0, Math.min(size, this.duration))
	if (!size) { return size; }

	this.duration -= size;
	var bufferSize = this.buffer.length;
	var end = index + size;

	for(var i = index; i < end; ++i) {
		buffer[i] = this.buffer[this.pointer++];
		this.pointer %= bufferSize;
	}

	return size;
}

AudioBuffer.prototype.dequeue = function(duration) {
	this.duration -= duration;
}

var FREQ = 4000;
var TIMER_FREQ = 60;
var SAMPLES = 16;
var BUFFER_SIZE = SAMPLES * 8


function audioEnable() {
	// this will only work if called directly from a user-generated input handler:
	if (audio && audio.state == 'suspended') audio.resume()
}

function audioSetup() {
	if (!audio) {
		if (typeof AudioContext !== 'undefined') {
			audio = new AudioContext();
		}
		else if (typeof webkitAudioContext !== 'undefined') {
			audio = new webkitAudioContext();
		}
	}
	audioEnable()
	if (audio && !audioNode) {
		audioNode = audio.createScriptProcessor(4096, 1, 1);
		audioNode.onaudioprocess = function(audioProcessingEvent) {
			var outputBuffer = audioProcessingEvent.outputBuffer;
			var outputData = outputBuffer.getChannelData(0);
			var samples_n = outputBuffer.length;

			var index = 0;
			while(audioData.length && index < samples_n) {
				var size = samples_n - index;
				var written = audioData[0].write(outputData, index, size);
				index += written;
				if (written < size) {
					audioData.shift();
				}
			}

			while(index < samples_n) {
				outputData[index++] = 0;
			}
			//the last one can be long sound with high value of buzzer, so always keep it
			if (audioData.length > 1) {
				var audioDataSize = 0;
				var audioBufferSize = audioNode.bufferSize;
				audioData.forEach(function(buffer) { audioDataSize += buffer.duration; })
				while(audioDataSize > audioBufferSize && audioData.length > 1) {
					audioDataSize -= audioData.shift().duration;
				}
			}
		}
		audioData = [];
		audioNode.connect(audio.destination);
		return true;
	}
	if (audio && audioNode) { return true; }
	return false;
}

function stopAudio() {
	if (!audio) { return; }
	if (audioNode) {
		audioNode.disconnect();
		audioNode = null;
	}
	audioData = [];
}

var VOLUME = 0.25;

function playPattern(soundLength, buffer, remainingTicks) {
	if (!audio) { return; }
	audioEnable()

	var samples = Math.floor(BUFFER_SIZE * audio.sampleRate / FREQ);
	var audioBuffer = new Array(samples);
	if (remainingTicks && audioData.length > 0) {
		audioData[audioData.length - 1].dequeue(Math.floor(remainingTicks * audio.sampleRate / TIMER_FREQ));
	}

	for(var i = 0; i < samples; ++i) {
		var srcIndex = Math.floor(i * FREQ / audio.sampleRate);
		var cell = srcIndex >> 3;
		var bit = srcIndex & 7;
		audioBuffer[i] = (buffer[srcIndex >> 3] & (0x80 >> bit)) ? VOLUME: 0;
	}
	audioData.push(new AudioBuffer(audioBuffer, Math.floor(soundLength * audio.sampleRate / TIMER_FREQ)));
}

function escapeHtml(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
}
</script>
<script>/**
* Adaptive Input
**/

const ael = (element, event, listener) => element.addEventListener   (event, listener, { passive:false })
const rel = (element, event, listener) => element.removeEventListener(event, listener, { passive:false })
const pd  = event => (event.preventDefault(),event.stopPropagation())

const VIP_HEX  = '123c456d789ea0bf'.split('')
const VIP_KEYS = VIP_HEX.map(x => parseInt(x,16))

const GAMEPAD_STYLES = `
.gamepad{
  position:absolute;
  top:10%;
  left:0px;
  width:100%;
  height:90%;
  opacity:0.3;
  user-select: none;
  -webkit-user-select: none;
}
.gamepad .dpad{
  position:absolute;
  bottom: 50px;
  left:   50px;
  width:  250px;
  height: 250px;
  background: gray;
  border-radius: 50%;
  overflow:hidden;
}
.gamepad .stick{
  display:none;
  position:absolute;
  border-radius: 50%;
  width:100px;
  height:100px;
  margin-left:-50px;
  margin-top:-50px;
}
.gamepad .buttons{
  position:absolute;
  bottom: 50px;
  right:  50px;
  width:  250px;
  height: 250px;
}
.gamepad .gamebutton{
  position:absolute;
  width:  125px;
  height: 125px;
  background:gray;
  border-radius:50%;
  overflow:hidden;
  line-height: 125px;
  font-size:50px;
  font-weight:bold;
  color:darkgray;
  text-align:center;
}
.gamepad .dpad.active .stick {display:block;background:#444}
.gamepad .gamebutton.active{background:#444;}
.gamepad .gamebutton.b{left:0;bottom:0;}
.gamepad .gamebutton.a{right:0;top:0;}
`
const VIP_STYLES = `
.vip-pad {display:flex;flex-direction:column;align-items:center;z-index:2000;}
.vip-pad .keypad {display:flex;flex-direction:column;margin-top:10px;}
.vip-pad .keypad>div {display:flex;flex-direction:row;}
.vip-pad .keypad>div>div {
  -webkit-user-select: none;
  user-select: none;
  background:gray;
  width: 100px;
  height: 51px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 1px;
}
.vip-pad .keypad>div>div:active,
.vip-pad .keypad>div>div.active {background:black; border:1px solid white;margin:0px;}
`

const INPUT_MODULES = {
  /**
  * An invisible set of gesture recognizers,
  * giving directional input and an action for taps.
  **/
  swipe: {
    install: (screen,up,down,options) => {

      let vdirs      = []
      let direction  = { i:null, sx:0, sy:0, lx:0, ly:0 }
      let action1    = {}
      let taptimeout = null

      const updateStick = _ => {
        // find the relative position of the stick to its starting point
        const cx = direction.lx - direction.sx
        const cy = direction.ly - direction.sy

        // update the virtual direction buttons
        let t = []
        const DEAD_ZONE = 30
        if (Math.abs(cx) > DEAD_ZONE) t.push(cx < 0 ? options.left : options.right)
        if (Math.abs(cy) > DEAD_ZONE) t.push(cy < 0 ? options.up   : options.down)
        vdirs.forEach(x => (t    .indexOf(x)<0) && up  (x)) // clear keys no longer held
        t    .forEach(x => (vdirs.indexOf(x)<0) && down(x)) // push keys that were not held before
        vdirs = t
      }
      const tapDown= i => {
        if (Object.keys(action1).length == 0) down(options.action1)
        action1[i] = true
        if (i == direction.i) { direction = { i:null, sx:0, sy:0, lx:0, ly:0 } }
        taptimeout = null
      }
      const start = e => {
        const t = e.touches[0]
        const i = t.identifier
        // a single-touch is either directional or a tap...
        if (direction.i != null) {
          tapDown(i)
        }
        else {
          direction.i  = i
          direction.sx = t.clientX
          direction.sy = t.clientY
          direction.lx = t.clientX
          direction.ly = t.clientY
          taptimeout = setTimeout(_ => tapDown(i), 100)
        }
        updateStick(),pd(e)
      }
      const move = e => {
        for(let z = 0; z < e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i == direction.i) {
            if (taptimeout != null) { clearTimeout(taptimeout); taptimeout = null }
            direction.lx = t.clientX
            direction.ly = t.clientY
          }
        }
        updateStick(),pd(e)
      }
      const end = e => {
        let r1 = false
        for(let z = 0; z < e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i == direction.i) {
            if (taptimeout != null) {
              // cancel a short tap
              clearTimeout(taptimeout); taptimeout = null
              down(options.action1)
              setTimeout(_ => up(options.action1), 50)
            }
            direction = { i:null, sx:0, sy:0, lx:0, ly:0 }
          }
          if (i in action1) {
            delete action1[i]
            r1=true
          }
        }
        if (r1 && Object.keys(action1).length == 0) up(options.action1)
        updateStick(),pd(e)
      }
      ael(screen, 'touchstart', start)
      ael(screen, 'touchmove',  move)
      ael(screen, 'touchend',   end)
      screen.uninstallSwipe = _ => {
        rel(screen, 'touchstart', start)
        rel(screen, 'touchmove',  move)
        rel(screen, 'touchend',   end)
      }
    },
    remove: (screen) => {
      screen.uninstallSwipe()
      delete screen.uninstallSwipe
    }
  },

  /**
  * A virtual gamepad overlay with two remappable action keys.
  **/
  gamepad: {
    install: (screen,up,down,options) => {
      // build the UI
      if (document.querySelector('.gamepad')) return
      const root = document.createElement('div')
      root.classList.add('gamepad')
      root.innerHTML = `
      <div class='dpad'><div class='stick'></div></div>
      <div class='buttons'><div class='gamebutton b'>B</div><div class='gamebutton a'>A</div></div>
      <style>${GAMEPAD_STYLES}</style>`
      screen.parentElement.append(root)

      let vdirs      = []
      let directions = {}
      let buttons    = {}
      const pad   = document.querySelector('.gamepad .dpad')
      const stick = document.querySelector('.gamepad .dpad .stick')
      const a     = document.querySelector('.gamepad .gamebutton.a')
      const b     = document.querySelector('.gamepad .gamebutton.b')

      const updateStick = _ => {
        // find centroid of d-pad touchpoints ({0,0} if no touchpoints)
        const touches = Object.values(directions)
        let cx = 0, cy = 0, r = pad.getBoundingClientRect(), sr = stick.getBoundingClientRect()
        touches.forEach(t => (cx+=t.x, cy+=t.y))
        cx /= touches.length,         cy /= touches.length
        cx -= (r.left + (r.width/2)), cy -= (r.top + (r.height/2))

        // position the virtual stick, clamped within dpad
        const ca = Math.atan2(cy, cx)
        const cd = Math.min(Math.sqrt(cx*cx + cy*cy), (r.width/2)-(sr.width/2))
        stick.style.left = ((Math.cos(ca)*cd)+(r.width /2)|0)+'px'
        stick.style.top  = ((Math.sin(ca)*cd)+(r.height/2)|0)+'px'

        // update the virtual direction buttons
        let t = []
        const DEAD_ZONE = 30
        if (Math.abs(cx) > DEAD_ZONE) t.push(cx < 0 ? options.left : options.right)
        if (Math.abs(cy) > DEAD_ZONE) t.push(cy < 0 ? options.up   : options.down)
        vdirs.forEach(x => (t    .indexOf(x)<0) && up  (x)) // clear keys no longer held
        t    .forEach(x => (vdirs.indexOf(x)<0) && down(x)) // push keys that were not held before
        vdirs = t
      }

      const start = e => {
        for(let z = 0; z<e.touches.length; z++) {
          const t = e.touches[z]
          const i = t.identifier
          if (t.target == a) {
            t.target.classList.add('active')
            buttons[i]=options.action1
            down(options.action1)
          }
          if (t.target == b) {
            t.target.classList.add('active')
            buttons[i]=options.action2
            down(options.action2)
          }
          if (t.target == pad) {
            t.target.classList.add('active')
            directions[i]={x:t.clientX, y:t.clientY}
          }
        }
        updateStick(),pd(e)
      }
      const move = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i in directions) directions[i]={x:t.clientX, y:t.clientY}
        }
        updateStick(),pd(e)
      }
      const end = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i in buttons) {
            t.target.classList.remove('active')
            up(buttons[i])
            delete buttons[i]
          }
          if (i in directions) {
            t.target.classList.remove('active')
            delete directions[i]
          }
        }
        updateStick(),pd(e)
      }

      ael(a,   'touchstart', start)
      ael(a,   'touchend',   end  )
      ael(b,   'touchstart', start)
      ael(b,   'touchend',   end  )
      ael(pad, 'touchstart', start)
      ael(pad, 'touchmove',  move )
      ael(pad, 'touchend',   end  )
    },
    remove: (screen) => {
      document.querySelector('.gamepad').remove()
    },
  },

  /**
  * Treat the entire screen, or a centered square region, as invisible buttons,
  * mapped out in the order of the VIP hex keypad.
  **/
  seg16: {
    install: (screen,up,down,options) => {
      const tmap = {}
      const pointToKey = touch => {
        // poll this for each point, as it may vary over time,
        // and experimentally it's never right initially...
        const r = screen.getBoundingClientRect()
        if (options.mode == 'center') {
          if (r.width > r.height) { r.x += (r.width - r.height)/2; r.width = r.height }
          else                    { r.y += (r.height - r.width)/2; r.height = r.width }
        }
        const x = touch.clientX - r.x
        const y = touch.clientY - r.y
        if (x < 0 || x > r.width || y < 0 || y > r.height) return null
        const tx = Math.floor(x / (r.width /4))
        const ty = Math.floor(y / (r.height/4))
        return VIP_KEYS[tx + (4 * ty)]
      }
      const start = e => {
        for(let z=0; z<e.touches.length; z++) {
          const i = e.touches[z].identifier
          const k = pointToKey(e.touches[z])
          if (k != null) down(k)
          tmap[i]=k
        }
        pd(e)
      }
      const move = e => {
        for(let z=0; z<e.touches.length; z++) {
          const i = e.touches[z].identifier
          const k = pointToKey(e.touches[z])
          if (tmap[i] == k) continue       // same cell, nothing to do.
          if (tmap[i] != null) up(tmap[i]) // release old key, if any
          if (k != null)       down(k)     // press new key, if any
          tmap[i]=k
        }
        pd(e)
      }
      const end = e => {
        for(let z=0; z<e.changedTouches.length; z++) {
          const i = e.changedTouches[z].identifier
          const k = pointToKey(e.changedTouches[z])
          if (tmap[i] != null) up(tmap[i])
          tmap[i]=null
        }
        pd(e)
      }
      ael(screen, 'touchstart', start)
      ael(screen, 'touchmove',  move )
      ael(screen, 'touchend',   end  )
      screen.uninstallSeg16 = _ => {
        rel(screen, 'touchstart', start)
        rel(screen, 'touchmove',  move )
        rel(screen, 'touchend',   end  )
      }
    },
    remove:  (screen) => {
      screen.uninstallSeg16()
      delete screen.uninstallSeg16
    },
  },

  /**
  * Provide a visible 4x4 representation of the VIP hex keypad.
  **/
  vip: {
    install: (screen,up,down,options) => {
      if (document.querySelector('.vip-pad')) return
      const root = document.createElement('div')
      root.classList.add('vip-pad')
      root.innerHTML = `<div class='keypad'>
        ${[0,1,2,3].map(r=>`<div>${[0,1,2,3].map(c=>`<div>${VIP_HEX[c+(r*4)].toUpperCase()}</div>`).join('')}</div>`).join('')}
      </div>
      <style>${VIP_STYLES}</style>`
      if (screen.parentElement == document.body) { screen.parentElement.append(root) }
      else { screen.parentElement.parentElement.append(root) }
      const buttons = []
      document.querySelectorAll('.vip-pad .keypad>div>div').forEach(x=>buttons.push(x)) // make an actual Array
      const held = {}
      const start = e => {
        for(let z=0; z<e.touches.length; z++) {
          const t = e.touches[z]
          const i = t.identifier
          const k = VIP_KEYS[buttons.indexOf(t.target)]
          t.target.classList.add('active')
          down(k)
          held[i]=k
        }
        pd(e)
      }
      const end = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (held[i]) { up(held[i]); delete held[i] }
          t.target.classList.remove('active')
        }
        pd(e)
      }
      buttons.forEach(b => {
        ael(b, 'touchstart', start)
        ael(b, 'touchend',   end  )
      })
    },
    remove:  (screen) => {
      document.querySelector('.vip-pad').remove()
    },
  },
}

let adaptiveControlsInstalled = null

function injectAdaptiveControls(type, screen, keyup, keydown) {
  let options = {
    up:      5,
    down:    8,
    left:    7,
    right:   9,
    action1: 6,
    action2: 4,
    mode:    'center', // or 'fill', used by seg16
  }
  const lookup = vk => Object.keys(keymap[vk])[0]
  const install = _ => {
    rel(screen, 'touchstart', install)
    adaptiveControlsInstalled = type
    INPUT_MODULES[type].install(
      screen,
      key => keyup  ({ key:lookup(key), preventDefault:_=>_ }),
      key => keydown({ key:lookup(key), preventDefault:_=>_ }),
      options
    )
  }
  // uninstall anything that's already there:
  rel(screen, 'touchstart', install)
  if (adaptiveControlsInstalled) INPUT_MODULES[adaptiveControlsInstalled].remove(screen)

  if (type == 'none') return
  if (type == 'seg16fill') { type='seg16'; options.mode='fill' }
  // defer installing adaptive input until we actually see
  // an input event from the user:
  ael(screen, 'touchstart', install)
}
</script>
<body><canvas id='target' width=512 height=256></canvas></body>
<style>body{margin:0px;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;}</style>
<script>
const emulator = new Emulator()
unpackOptions(emulator, data.options)
setRenderTarget(data.options.displayScale || 4, 'target')
emulator.init({rom:data.rom})
emulator.importFlags = _ => getPref('octoFlagRegisters')
emulator.exportFlags = f => setPref('octoFlagRegisters',f)
emulator.buzzTrigger = (ticks,rest)=> playPattern(ticks, emulator.pattern, rest)
const kd = e=>{
	if (!audio) audioSetup()
	if (!(e.key in emulator.keys)) emulator.keys[e.key]=true
	e.preventDefault()
}
const ku = e=>{
	if (e.key in emulator.keys) delete emulator.keys[e.key]
	if (!emulator.waiting) return
	const kindex = keymapInverse[e.key]
	if (kindex != undefined) {
		emulator.waiting = false
		emulator.v[emulator.waitReg] = kindex
	}
	e.preventDefault()
}
window.addEventListener('keydown',kd,false)
window.addEventListener('keyup',ku,false)
intervalHandle = setInterval(_=>{
	if (emulator.halted) return
	for(var z = 0; (z<emulator.tickrate) && (!emulator.waiting); z++) emulator.tick()
	if (emulator.dt > 0) emulator.dt--
	if (emulator.st > 0) emulator.st--
	renderDisplay(emulator)
	document.body.style.backgroundColor = emulator.st?emulator.buzzColor:emulator.quietColor
}, 1000/60)

injectAdaptiveControls(emulator.touchInputMode,document.getElementById('target'),ku,kd)
</script>
